<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botfs23 - Telegram Chat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }
        
        .loading-logo {
            font-size: 48px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .loading-subtext {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .custom-alert {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff3b30;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .telegram-app {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
        .chat-container, .users-container, .admin-container {
            transition: opacity 0.3s ease;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
        .messages-container::-webkit-scrollbar {
            width: 5px;
        }
        
        .messages-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        
        .messages-container::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        
        .messages-container::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .demo-user {
            position: relative;
        }
        
        .demo-user::after {
            content: "DEMO";
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff9500;
            color: white;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        .new-message {
            animation: highlight 2s ease;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(52, 199, 89, 0.1); }
            100% { background-color: transparent; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–¥–µ–ª–∞ */
        .section-selector {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 10px;
            z-index: 1000;
        }
        
        .section-selector.active {
            display: block;
        }
        
        .section-selector-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .section-selector-item:hover {
            background: #f5f5f5;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
        .upload-progress {
            display: none;
            position: absolute;
            bottom: 70px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .upload-progress.active {
            display: block;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: #34c759;
            transition: width 0.3s ease;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤ */
        .file-preview {
            display: none;
            position: absolute;
            bottom: 70px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .file-preview.active {
            display: block;
        }
        
        .file-preview-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .file-preview-icon {
            font-size: 32px;
            color: #3390ec;
        }
        
        .file-preview-info {
            flex: 1;
        }
        
        .file-preview-name {
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-all;
        }
        
        .file-preview-size {
            font-size: 12px;
            color: #666;
        }
        
        .file-preview-actions {
            display: flex;
            gap: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º */
        .search-results {
            display: none;
            position: absolute;
            top: 56px;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 100;
        }
        
        .search-results.active {
            display: block;
        }
        
        .search-results-header {
            background: #3390ec;
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-results-count {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .search-results-list {
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–∏ */
        .reaction-selector {
            display: none;
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 24px;
            padding: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .reaction-selector.active {
            display: block;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .user-menu {
            display: none;
            position: fixed;
            top: 60px;
            right: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
        }
        
        .user-menu.active {
            display: block;
        }
        
        .user-menu-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
            border-radius: 8px;
            margin: 5px;
        }
        
        .user-menu-item:hover {
            background: #f5f5f5;
        }
        
        .user-menu-item i {
            width: 20px;
            color: #3390ec;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            font-weight: 500;
        }
        
        .settings-value {
            color: #666;
            font-size: 14px;
        }
        
        .settings-toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .settings-toggle input:checked + .settings-toggle-slider {
            background-color: #3390ec;
        }
        
        .settings-toggle input:checked + .settings-toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stats-number {
            font-size: 28px;
            font-weight: 600;
            color: #3390ec;
            margin-bottom: 5px;
        }
        
        .stats-label {
            font-size: 14px;
            color: #666;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        body.dark-theme .section-selector,
        body.dark-theme .upload-progress,
        body.dark-theme .file-preview,
        body.dark-theme .search-results,
        body.dark-theme .reaction-selector,
        body.dark-theme .user-menu,
        body.dark-theme .settings-item {
            background: #1c1c1e;
            color: white;
        }
        
        body.dark-theme .section-selector-item:hover,
        body.dark-theme .user-menu-item:hover {
            background: #2c2c2e;
        }
        
        body.dark-theme .stats-card {
            background: #2c2c2e;
            color: white;
        }
        
        body.dark-theme .stats-label {
            color: #aaa;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">
            <i class="fab fa-telegram"></i>
        </div>
        <div class="loading-text">Botfs23 Chat</div>
        <div class="loading-subtext">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="loading-spinner" style="margin-top: 20px;"></div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="custom-alert" id="custom-alert"></div>

    <!-- –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="telegram-app" id="telegram-app" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="btn-menu" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="chat-info">
                    <div class="chat-title" id="chat-title">Botfs23</div>
                    <div class="chat-status">–æ–Ω–ª–∞–π–Ω: <span id="online-count">1</span></div>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn btn-mention-all" id="btn-mention-all" onclick="mentionAll()" title="–£–ø–æ–º—è–Ω—É—Ç—å –≤—Å–µ—Ö –æ–Ω–ª–∞–π–Ω" style="display: none;">
                    <i class="fas fa-at"></i>
                </button>
                <button class="header-btn btn-jump" id="btn-jump" onclick="jumpToUnread()" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º">
                    <i class="fas fa-arrow-down"></i>
                    <span class="unread-badge" id="unread-badge"></span>
                </button>
                <button class="header-btn btn-admin" id="btn-admin" onclick="showAdminPanel()" title="–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                </button>
                <button class="header-btn btn-users" onclick="showUsersList()" title="–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤">
                    <i class="fas fa-users"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">
                        <img id="user-avatar-img" src="" alt="" onerror="hideImage(this)" style="display: none;">
                        <i class="fas fa-user" id="user-avatar-icon"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="user-role" id="user-role">—É—á–∞—Å—Ç–Ω–∏–∫</div>
                    </div>
                </div>
                <button class="btn-close-sidebar" onclick="toggleSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
            <div class="sections-list">
                <div class="section-item active" onclick="switchSection('main')">
                    <i class="fas fa-comments"></i>
                    <span class="section-name">–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç</span>
                    <span class="section-unread" id="main-unread"></span>
                </div>
                <div class="section-item" onclick="switchSection('news')">
                    <i class="fas fa-newspaper"></i>
                    <span class="section-name">–ù–æ–≤–æ—Å—Ç–∏</span>
                    <span class="section-unread" id="news-unread"></span>
                </div>
                <div class="section-item" onclick="switchSection('rules')">
                    <i class="fas fa-book"></i>
                    <span class="section-name">–ü—Ä–∞–≤–∏–ª–∞</span>
                    <span class="section-locked"><i class="fas fa-lock"></i></span>
                </div>
                <div class="section-item" onclick="switchSection('announcements')">
                    <i class="fas fa-bullhorn"></i>
                    <span class="section-name">–û–±—ä—è–≤–ª–µ–Ω–∏—è</span>
                    <span class="section-unread" id="announcements-unread"></span>
                </div>
            </div>
            
            <!-- –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="showChat()">
                    <i class="fas fa-comments"></i>
                    <span>–ß–∞—Ç</span>
                    <span class="menu-badge" id="chat-badge"></span>
                </div>
                <div class="menu-item" onclick="showUsersList()">
                    <i class="fas fa-users"></i>
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                    <span class="menu-badge" id="users-badge"></span>
                </div>
                <div class="menu-item" onclick="showAdminPanel()" id="admin-menu-item" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <span>–ê–¥–º–∏–Ω–∫–∞</span>
                </div>
                <div class="menu-item" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </div>
                <div class="menu-item" onclick="showProfile()">
                    <i class="fas fa-user"></i>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="online-users">
                    <i class="fas fa-circle online-dot"></i>
                    <span id="sidebar-online-count">1</span> –æ–Ω–ª–∞–π–Ω
                </div>
                <div class="app-version">v3.0</div>
            </div>
        </div>

        <!-- Overlay –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ -->
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ß–∞—Ç -->
            <div class="chat-container active" id="chat-view">
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div class="messages-container" id="messages-container">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="empty-chat">
                        <i class="fas fa-comments"></i>
                        <p>–ß–∞—Ç –ø—É—Å—Ç</p>
                        <small>–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</small>
                    </div>
                </div>
                
                <!-- –ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ -->
                <div class="reply-preview-container" id="reply-preview-container"></div>
                
                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="message-input-area">
                    <button class="btn-attach" onclick="toggleAttachMenu()">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    
                    <!-- –ú–µ–Ω—é –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ -->
                    <div class="attach-menu" id="attach-menu">
                        <div class="attach-item" onclick="attachFile('photo')">
                            <i class="fas fa-image"></i>
                            <span>–§–æ—Ç–æ</span>
                        </div>
                        <div class="attach-item" onclick="attachFile('document')">
                            <i class="fas fa-file"></i>
                            <span>–î–æ–∫—É–º–µ–Ω—Ç</span>
                        </div>
                        <div class="attach-item" onclick="attachFile('sticker')">
                            <i class="far fa-smile"></i>
                            <span>–°—Ç–∏–∫–µ—Ä</span>
                        </div>
                        <div class="attach-item" onclick="attachFile('voice')">
                            <i class="fas fa-microphone"></i>
                            <span>–ì–æ–ª–æ—Å–æ–≤–æ–µ</span>
                        </div>
                    </div>
                    
                    <div class="input-wrapper">
                        <textarea 
                            id="message-input" 
                            placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                            rows="1"
                            onkeypress="handleKeyPress(event)"
                            oninput="autoResize(this)"></textarea>
                        <div class="input-actions">
                            <button class="btn-emoji" onclick="toggleEmojiPicker()">
                                <i class="far fa-smile"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn-send" onclick="sendMessage()" id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- –≠–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä -->
                <div class="emoji-picker" id="emoji-picker">
                    <div class="emoji-categories">
                        <button class="emoji-category active" onclick="showEmojiCategory('smileys')">üòÄ</button>
                        <button class="emoji-category" onclick="showEmojiCategory('people')">üëã</button>
                        <button class="emoji-category" onclick="showEmojiCategory('symbols')">‚ù§Ô∏è</button>
                        <button class="emoji-category" onclick="showEmojiCategory('nature')">üê∂</button>
                        <button class="emoji-category" onclick="showEmojiCategory('food')">üçï</button>
                    </div>
                    <div class="emoji-grid" id="emoji-grid"></div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-container" id="users-view">
                <div class="users-header">
                    <h2><i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
                    <div class="users-search">
                        <input type="text" id="users-search-input" placeholder="–ü–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤..." oninput="searchUsers(this.value)">
                        <button class="btn-close-search" onclick="clearUserSearch()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="users-list" id="users-list">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
            <div class="admin-container" id="admin-view">
                <div class="admin-header">
                    <h2><i class="fas fa-user-shield"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p>
                </div>
                
                <div class="admin-sections">
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-users-cog"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>
                        <div class="admin-users-list" id="admin-users-list">
                            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-user-plus"></i> –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action primary large" onclick="createInvite()">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                            </button>
                            <div class="invites-list" id="invites-list">
                                <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π -->
                                <div class="empty-chat">
                                    <i class="fas fa-envelope"></i>
                                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>
                                    <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-folder"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</h3>
                        <div class="sections-admin-list">
                            <div class="section-permissions">
                                <div class="permission-item">
                                    <span>–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç:</span>
                                    <select class="permission-select" onchange="updateSectionPermission('main', 'write', this.value)">
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–ù–æ–≤–æ—Å—Ç–∏:</span>
                                    <select class="permission-select" onchange="updateSectionPermission('news', 'write', this.value)">
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–ü—Ä–∞–≤–∏–ª–∞:</span>
                                    <select class="permission-select" onchange="updateSectionPermission('rules', 'write', this.value)">
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–û–±—ä—è–≤–ª–µ–Ω–∏—è:</span>
                                    <select class="permission-select" onchange="updateSectionPermission('announcements', 'write', this.value)">
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ê–¥–º–∏–Ω –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-tools"></i> –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action danger" onclick="clearChatHistory()">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
                            </button>
                            <button class="btn-admin-action primary" onclick="exportChatData()">
                                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                            </button>
                            <button class="btn-admin-action primary" onclick="createBackup()">
                                <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="settings-container" id="settings-view" style="display: none;">
                <div class="admin-header">
                    <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–µ–±—è</p>
                </div>
                
                <div class="admin-sections">
                    <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-palette"></i> –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="dark-theme-toggle" onchange="toggleTheme()">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</div>
                                <select class="permission-select" id="font-size-select" onchange="changeFontSize(this.value)">
                                    <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                                    <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="large">–ë–æ–ª—å—à–æ–π</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–ê–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="auto-scroll-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–ó–≤—É–∫ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="sound-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–í–∏–±—Ä–æ—Å–∏–≥–Ω–∞–ª</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="vibration-toggle">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–≤—å—é</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="preview-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="stats-grid">
                            <div class="stats-card">
                                <div class="stats-number" id="stats-messages">0</div>
                                <div class="stats-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-users">1</div>
                                <div class="stats-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-sections">4</div>
                                <div class="stats-label">–†–∞–∑–¥–µ–ª–æ–≤</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-online">1</div>
                                <div class="stats-label">–û–Ω–ª–∞–π–Ω</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-info-circle"></i> –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–í–µ—Ä—Å–∏—è</div>
                                <div class="settings-value">3.0.0</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</div>
                                <div class="settings-value">Botfs23 Team</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">Telegram WebApp</div>
                                <div class="settings-value">SDK v6.7</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="profile-container" id="profile-view" style="display: none;">
                <div class="admin-header">
                    <h2><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å</h2>
                    <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ</p>
                </div>
                
                <div class="admin-sections">
                    <div class="admin-section">
                        <div class="user-profile" style="justify-content: center; margin-bottom: 30px;">
                            <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;">
                                <img id="profile-avatar-img" src="" alt="" onerror="hideProfileImage(this)" style="display: none;">
                                <i class="fas fa-user" id="profile-avatar-icon"></i>
                            </div>
                        </div>
                        
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–ò–º—è</div>
                                <div class="settings-value" id="profile-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">Username</div>
                                <div class="settings-value" id="profile-username">@user</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">ID</div>
                                <div class="settings-value" id="profile-id">000000</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–æ–ª—å</div>
                                <div class="settings-value" id="profile-role">—É—á–∞—Å—Ç–Ω–∏–∫</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–°—Ç–∞—Ç—É—Å</div>
                                <div class="settings-value" id="profile-status">–æ–Ω–ª–∞–π–Ω</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                                <div class="settings-value" id="profile-messages">0</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–í —Å–µ—Ç–∏ —Å</div>
                                <div class="settings-value" id="profile-joined">—Å–µ–≥–æ–¥–Ω—è</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-user-edit"></i> –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action primary" onclick="editProfile()">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                            </button>
                            <button class="btn-admin-action primary" onclick="changePassword()">
                                <i class="fas fa-key"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </button>
                            <button class="btn-admin-action danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø—ã –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    
    <!-- –†–µ–∞–∫—Ü–∏–∏ –ø–æ–ø–∞–ø -->
    <div class="reactions-popup" id="reactions-popup">
        <div class="reactions-options">
            <button class="reaction-option" onclick="addReaction('üëç')">üëç</button>
            <button class="reaction-option" onclick="addReaction('‚ù§Ô∏è')">‚ù§Ô∏è</button>
            <button class="reaction-option" onclick="addReaction('üòÇ')">üòÇ</button>
            <button class="reaction-option" onclick="addReaction('üòÆ')">üòÆ</button>
            <button class="reaction-option" onclick="addReaction('üò¢')">üò¢</button>
            <button class="reaction-option" onclick="addReaction('üò°')">üò°</button>
            <button class="reaction-option" onclick="addReaction('üéâ')">üéâ</button>
            <button class="reaction-option" onclick="addReaction('üî•')">üî•</button>
            <button class="reaction-option" onclick="addReaction('üëè')">üëè</button>
            <button class="reaction-option" onclick="addReaction('üôè')">üôè</button>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="message-context-menu" id="message-context-menu">
        <div class="context-menu-item" onclick="contextMenuReply()">
            <i class="fas fa-reply"></i>
            <span>–û—Ç–≤–µ—Ç–∏—Ç—å</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuCopy()">
            <i class="fas fa-copy"></i>
            <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuCopyLink()">
            <i class="fas fa-link"></i>
            <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuAddToFavorites()">
            <i class="fas fa-star"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuForward()">
            <i class="fas fa-share"></i>
            <span>–ü–µ—Ä–µ—Å–ª–∞—Ç—å</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuReaction()">
            <i class="far fa-smile"></i>
            <span>–†–µ–∞–∫—Ü–∏—è</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="contextMenuEdit()">
            <i class="fas fa-edit"></i>
            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuDelete()">
            <i class="fas fa-trash"></i>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" onclick="contextMenuReport()">
            <i class="fas fa-flag"></i>
            <span>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuSelect()">
            <i class="fas fa-check-square"></i>
            <span>–í—ã–±—Ä–∞—Ç—å</span>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ -->
    <div class="forward-popup" id="forward-popup">
        <div class="forward-header">
            <h3>–ü–µ—Ä–µ—Å–ª–∞—Ç—å –≤...</h3>
            <button class="btn-close-forward" onclick="closeForwardPopup()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="forward-options" id="forward-options">
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="upload-progress" id="upload-progress">
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%;"></div>
        </div>
    </div>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞ -->
    <div class="file-preview" id="file-preview">
        <div class="file-preview-content">
            <div class="file-preview-icon">
                <i class="fas fa-file"></i>
            </div>
            <div class="file-preview-info">
                <div class="file-preview-name" id="file-preview-name">file.pdf</div>
                <div class="file-preview-size" id="file-preview-size">2.4 MB</div>
            </div>
            <div class="file-preview-actions">
                <button class="btn-admin-action primary" onclick="sendFile()">
                    <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
                <button class="btn-admin-action danger" onclick="cancelFile()">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –¢–æ–≥–≥–ª–µ—Ä —Ç–µ–º—ã -->
    <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <script>
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è HTML
        function hideImage(img) {
            img.style.display = 'none';
            const icon = document.getElementById('user-avatar-icon');
            if (icon) icon.style.display = 'block';
        }
        
        function hideProfileImage(img) {
            img.style.display = 'none';
            const icon = document.getElementById('profile-avatar-icon');
            if (icon) icon.style.display = 'block';
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                if (window.sendMessage) {
                    window.sendMessage();
                }
            }
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        function showChat() {
            document.querySelectorAll('.chat-container, .users-container, .admin-container, .settings-container, .profile-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            const chatView = document.getElementById('chat-view');
            if (chatView) {
                chatView.classList.add('active');
                chatView.style.display = 'flex';
            }
            updateMenuActive(0);
            hideAllPopups();
        }
        
        function showUsersList() {
            document.querySelectorAll('.chat-container, .users-container, .admin-container, .settings-container, .profile-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            const usersView = document.getElementById('users-view');
            if (usersView) {
                usersView.classList.add('active');
                usersView.style.display = 'flex';
                if (window.loadUsers) {
                    window.loadUsers();
                }
            }
            updateMenuActive(1);
            hideAllPopups();
        }
        
        function showAdminPanel() {
            document.querySelectorAll('.chat-container, .users-container, .admin-container, .settings-container, .profile-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            const adminView = document.getElementById('admin-view');
            if (adminView) {
                adminView.classList.add('active');
                adminView.style.display = 'flex';
                if (window.loadAdminUsersList) {
                    window.loadAdminUsersList();
                }
                if (window.loadInvitesList) {
                    window.loadInvitesList();
                }
            }
            updateMenuActive(2);
            hideAllPopups();
        }
        
        function showSettings() {
            document.querySelectorAll('.chat-container, .users-container, .admin-container, .settings-container, .profile-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            const settingsView = document.getElementById('settings-view');
            if (settingsView) {
                settingsView.classList.add('active');
                settingsView.style.display = 'flex';
                updateStats();
            }
            updateMenuActive(3);
            hideAllPopups();
        }
        
        function showProfile() {
            document.querySelectorAll('.chat-container, .users-container, .admin-container, .settings-container, .profile-container').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            const profileView = document.getElementById('profile-view');
            if (profileView) {
                profileView.classList.add('active');
                profileView.style.display = 'flex';
                updateProfileInfo();
            }
            updateMenuActive(4);
            hideAllPopups();
        }
        
        function updateMenuActive(activeIndex) {
            document.querySelectorAll('.menu-item').forEach((item, index) => {
                item.classList.toggle('active', index === activeIndex);
            });
        }
        
        function switchSection(sectionId) {
            if (window.switchSection) {
                window.switchSection(sectionId);
            }
            toggleSidebar();
        }
        
        function toggleAttachMenu() {
            const attachMenu = document.getElementById('attach-menu');
            attachMenu.classList.toggle('active');
        }
        
        function toggleEmojiPicker() {
            const emojiPicker = document.getElementById('emoji-picker');
            emojiPicker.classList.toggle('active');
        }
        
        function attachFile(type) {
            if (window.attachFile) {
                window.attachFile(type);
            }
            toggleAttachMenu();
        }
        
        function showEmojiCategory(category) {
            if (window.showEmojiCategory) {
                window.showEmojiCategory(category);
            }
        }
        
        function searchUsers(query) {
            if (window.searchUsers) {
                window.searchUsers(query);
            }
        }
        
        function clearUserSearch() {
            const searchInput = document.getElementById('users-search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            if (window.searchUsers) {
                window.searchUsers('');
            }
        }
        
        function updateSectionPermission(sectionId, type, value) {
            if (window.updateSectionPermission) {
                window.updateSectionPermission(sectionId, type, value);
            }
        }
        
        function createInvite() {
            if (window.createInvite) {
                window.createInvite();
            }
        }
        
        function clearChatHistory() {
            if (window.clearChatHistory) {
                window.clearChatHistory();
            }
        }
        
        function exportChatData() {
            if (window.exportChatData) {
                window.exportChatData();
            }
        }
        
        function createBackup() {
            if (window.createBackup) {
                window.createBackup();
            }
        }
        
        function jumpToUnread() {
            if (window.jumpToUnread) {
                window.jumpToUnread();
            }
        }
        
        function mentionAll() {
            if (window.mentionAll) {
                window.mentionAll();
            }
        }
        
        function addReaction(emoji) {
            const popup = document.getElementById('reactions-popup');
            const messageId = popup.dataset.messageId;
            if (window.toggleReaction && messageId) {
                window.toggleReaction(messageId, emoji);
            }
            popup.style.display = 'none';
        }
        
        function showReactionPopup(messageId) {
            const popup = document.getElementById('reactions-popup');
            popup.style.display = 'block';
            popup.dataset.messageId = messageId;
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–ø–∞–ø
            const button = event.target;
            const rect = button.getBoundingClientRect();
            popup.style.left = (rect.left - 100) + 'px';
            popup.style.top = (rect.top - 60) + 'px';
        }
        
        function closeForwardPopup() {
            document.getElementById('forward-popup').style.display = 'none';
        }
        
        function showMessageMenu(messageId) {
            const menu = document.getElementById('message-context-menu');
            const button = event.target.closest('.btn-more') || event.target;
            const rect = button.getBoundingClientRect();
            
            menu.style.left = (rect.left - 180) + 'px';
            menu.style.top = (rect.top + 30) + 'px';
            menu.style.display = 'block';
            menu.dataset.messageId = messageId;
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
            setTimeout(() => {
                const closeHandler = (e) => {
                    if (!menu.contains(e.target) && e.target !== button) {
                        menu.style.display = 'none';
                        document.removeEventListener('click', closeHandler);
                    }
                };
                document.addEventListener('click', closeHandler);
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function contextMenuReply() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            if (window.replyToMessage && messageId) {
                window.replyToMessage(messageId);
            }
            menu.style.display = 'none';
        }
        
        function contextMenuCopy() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
            menu.style.display = 'none';
        }
        
        function contextMenuCopyLink() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            const link = `https://t.me/botfs23/message/${messageId}`;
            navigator.clipboard.writeText(link).then(() => {
                showCustomAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏: ', err);
            });
            menu.style.display = 'none';
        }
        
        function contextMenuForward() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            if (window.forwardMessage && messageId) {
                window.forwardMessage(messageId);
            }
            menu.style.display = 'none';
        }
        
        function contextMenuReaction() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            if (window.showReactionPopup && messageId) {
                window.showReactionPopup(messageId);
            }
            menu.style.display = 'none';
        }
        
        function contextMenuDelete() {
            const menu = document.getElementById('message-context-menu');
            const messageId = menu.dataset.messageId;
            if (window.deleteMessage && messageId) {
                window.deleteMessage(messageId);
            }
            menu.style.display = 'none';
        }
        
        function hideAllPopups() {
            document.getElementById('attach-menu').classList.remove('active');
            document.getElementById('emoji-picker').classList.remove('active');
            document.getElementById('message-context-menu').style.display = 'none';
            document.getElementById('forward-popup').style.display = 'none';
            document.getElementById('reactions-popup').style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function toggleTheme() {
            const toggle = document.getElementById('dark-theme-toggle');
            const isDark = toggle.checked;
            document.body.classList.toggle('dark-theme', isDark);
            localStorage.setItem('darkTheme', isDark);
            
            const themeIcon = document.getElementById('theme-icon');
            if (themeIcon) {
                themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
        }
        
        function changeFontSize(size) {
            document.body.style.fontSize = size === 'small' ? '13px' : size === 'large' ? '16px' : '14px';
            localStorage.setItem('fontSize', size);
        }
        
        function editProfile() {
            showCustomAlert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        function changePassword() {
            showCustomAlert('–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.clear();
                showCustomAlert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤
        function sendFile() {
            showCustomAlert('–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
            hideFilePreview();
        }
        
        function cancelFile() {
            hideFilePreview();
        }
        
        function hideFilePreview() {
            document.getElementById('file-preview').classList.remove('active');
        }
        
        function showUploadProgress() {
            document.getElementById('upload-progress').classList.add('active');
        }
        
        function hideUploadProgress() {
            document.getElementById('upload-progress').classList.remove('active');
        }
        
        function updateProgress(percent) {
            const progressBar = document.getElementById('progress-bar-fill');
            if (progressBar) {
                progressBar.style.width = percent + '%';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showCustomAlert(message, type = 'info') {
            const alert = document.getElementById('custom-alert');
            if (!alert) return;
            
            alert.textContent = message;
            alert.className = 'custom-alert';
            
            switch (type) {
                case 'success':
                    alert.style.background = '#34c759';
                    break;
                case 'error':
                    alert.style.background = '#ff3b30';
                    break;
                case 'warning':
                    alert.style.background = '#ff9500';
                    break;
                default:
                    alert.style.background = '#3390ec';
            }
            
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –ø—Ä–æ—Ñ–∏–ª—è
        function updateStats() {
            // –≠—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
            document.getElementById('stats-messages').textContent = '0';
            document.getElementById('stats-users').textContent = '1';
            document.getElementById('stats-sections').textContent = '4';
            document.getElementById('stats-online').textContent = '1';
        }
        
        function updateProfileInfo() {
            // –≠—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
            const userName = document.getElementById('user-name').textContent;
            const userRole = document.getElementById('user-role').textContent;
            
            document.getElementById('profile-name').textContent = userName;
            document.getElementById('profile-role').textContent = userRole;
            document.getElementById('profile-username').textContent = '@user';
            document.getElementById('profile-id').textContent = '000000';
            document.getElementById('profile-status').textContent = '–æ–Ω–ª–∞–π–Ω';
            document.getElementById('profile-messages').textContent = '0';
            document.getElementById('profile-joined').textContent = new Date().toLocaleDateString('ru-RU');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingScreen = document.getElementById('loading-screen');
            const app = document.getElementById('telegram-app');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const savedTheme = localStorage.getItem('darkTheme') === 'true';
            const savedFontSize = localStorage.getItem('fontSize') || 'medium';
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('dark-theme-toggle').checked = savedTheme;
            document.getElementById('font-size-select').value = savedFontSize;
            toggleTheme();
            changeFontSize(savedFontSize);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ç–æ –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                const user = tg.initDataUnsafe?.user;
                
                if (user && user.photo_url) {
                    const img = document.getElementById('user-avatar-img');
                    const profileImg = document.getElementById('profile-avatar-img');
                    if (img) {
                        img.src = user.photo_url;
                        img.style.display = 'block';
                        const icon = document.getElementById('user-avatar-icon');
                        if (icon) icon.style.display = 'none';
                    }
                    if (profileImg) {
                        profileImg.src = user.photo_url;
                        profileImg.style.display = 'block';
                        const profileIcon = document.getElementById('profile-avatar-icon');
                        if (profileIcon) profileIcon.style.display = 'none';
                    }
                }
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
            setTimeout(() => {
                if (window.initApp) {
                    window.initApp();
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    app.style.display = 'flex';
                }, 500);
            }, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', e.error);
            showCustomAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏', 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ:', e.reason);
            showCustomAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
        });
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π JavaScript —Ñ–∞–π–ª -->
    <script src="script.js"></script>
</body>
</html>
