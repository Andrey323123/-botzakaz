<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botfs23 - Telegram Chat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">
            <i class="fab fa-telegram"></i>
        </div>
        <div class="loading-text">Botfs23 Chat</div>
        <div class="loading-subtext">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="custom-alert" id="custom-alert"></div>

    <!-- –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="telegram-app" id="telegram-app" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="btn-menu" id="btn-menu">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="chat-info">
                    <div class="chat-title" id="chat-title">Botfs23</div>
                    <div class="chat-status">–æ–Ω–ª–∞–π–Ω: <span id="online-count">1</span></div>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn btn-mention-all" id="btn-mention-all" title="–£–ø–æ–º—è–Ω—É—Ç—å –≤—Å–µ—Ö –æ–Ω–ª–∞–π–Ω" style="display: none;">
                    <i class="fas fa-at"></i>
                </button>
                <button class="header-btn btn-jump" id="btn-jump" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º">
                    <i class="fas fa-arrow-down"></i>
                    <span class="unread-badge" id="unread-badge"></span>
                </button>
                <button class="header-btn btn-admin" id="btn-admin" title="–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                </button>
                <button class="header-btn btn-users" id="btn-users" title="–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤">
                    <i class="fas fa-users"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">
                        <img id="user-avatar-img" src="" alt="" onerror="hideImage(this)" style="display: none;">
                        <i class="fas fa-user" id="user-avatar-icon"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="user-role" id="user-role">—É—á–∞—Å—Ç–Ω–∏–∫</div>
                    </div>
                </div>
                <button class="btn-close-sidebar" id="btn-close-sidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
            <div class="sections-list">
                <div class="section-item active" data-section="main">
                    <i class="fas fa-comments"></i>
                    <span class="section-name">–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç</span>
                    <span class="section-unread" id="main-unread"></span>
                </div>
                <div class="section-item" data-section="news">
                    <i class="fas fa-newspaper"></i>
                    <span class="section-name">–ù–æ–≤–æ—Å—Ç–∏</span>
                    <span class="section-unread" id="news-unread"></span>
                </div>
                <div class="section-item" data-section="rules">
                    <i class="fas fa-book"></i>
                    <span class="section-name">–ü—Ä–∞–≤–∏–ª–∞</span>
                    <span class="section-locked"><i class="fas fa-lock"></i></span>
                </div>
                <div class="section-item" data-section="announcements">
                    <i class="fas fa-bullhorn"></i>
                    <span class="section-name">–û–±—ä—è–≤–ª–µ–Ω–∏—è</span>
                    <span class="section-unread" id="announcements-unread"></span>
                </div>
            </div>
            
            <!-- –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div class="sidebar-menu">
                <div class="menu-item active" data-view="chat">
                    <i class="fas fa-comments"></i>
                    <span>–ß–∞—Ç</span>
                    <span class="menu-badge" id="chat-badge"></span>
                </div>
                <div class="menu-item" data-view="users">
                    <i class="fas fa-users"></i>
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                    <span class="menu-badge" id="users-badge"></span>
                </div>
                <div class="menu-item" data-view="admin" id="admin-menu-item" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <span>–ê–¥–º–∏–Ω–∫–∞</span>
                </div>
                <div class="menu-item" data-view="settings">
                    <i class="fas fa-cog"></i>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </div>
                <div class="menu-item" data-view="profile">
                    <i class="fas fa-user"></i>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="online-users">
                    <i class="fas fa-circle online-dot"></i>
                    <span id="sidebar-online-count">1</span> –æ–Ω–ª–∞–π–Ω
                </div>
                <div class="app-version">v3.0</div>
            </div>
        </div>

        <!-- Overlay –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ -->
        <div class="overlay" id="overlay"></div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ß–∞—Ç -->
            <div class="chat-container active" id="chat-view">
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div class="messages-container" id="messages-container">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="empty-chat">
                        <i class="fas fa-comments"></i>
                        <p>–ß–∞—Ç –ø—É—Å—Ç</p>
                        <small>–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</small>
                    </div>
                </div>
                
                <!-- –ü—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞ -->
                <div class="reply-preview-container" id="reply-preview-container"></div>
                
                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="message-input-area">
                    <button class="btn-attach" id="btn-attach">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    
                    <!-- –ú–µ–Ω—é –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ -->
                    <div class="attach-menu" id="attach-menu">
                        <div class="attach-item" data-type="photo">
                            <i class="fas fa-image"></i>
                            <span>–§–æ—Ç–æ</span>
                        </div>
                        <div class="attach-item" data-type="document">
                            <i class="fas fa-file"></i>
                            <span>–î–æ–∫—É–º–µ–Ω—Ç</span>
                        </div>
                        <div class="attach-item" data-type="sticker">
                            <i class="far fa-smile"></i>
                            <span>–°—Ç–∏–∫–µ—Ä</span>
                        </div>
                        <div class="attach-item" data-type="voice">
                            <i class="fas fa-microphone"></i>
                            <span>–ì–æ–ª–æ—Å–æ–≤–æ–µ</span>
                        </div>
                    </div>
                    
                    <div class="input-wrapper">
                        <textarea 
                            id="message-input" 
                            placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                            rows="1"></textarea>
                        <div class="input-actions">
                            <button class="btn-emoji" id="btn-emoji">
                                <i class="far fa-smile"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn-send" id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- –≠–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä -->
                <div class="emoji-picker" id="emoji-picker">
                    <div class="emoji-categories">
                        <button class="emoji-category active" data-category="smileys">üòÄ</button>
                        <button class="emoji-category" data-category="people">üëã</button>
                        <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
                        <button class="emoji-category" data-category="nature">üê∂</button>
                        <button class="emoji-category" data-category="food">üçï</button>
                    </div>
                    <div class="emoji-grid" id="emoji-grid"></div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-container" id="users-view">
                <div class="users-header">
                    <h2><i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
                    <div class="users-search">
                        <input type="text" id="users-search-input" placeholder="–ü–æ–∏—Å–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...">
                        <button class="btn-close-search" id="btn-close-search">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="users-list" id="users-list">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
            <div class="admin-container" id="admin-view">
                <div class="admin-header">
                    <h2><i class="fas fa-user-shield"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</p>
                </div>
                
                <div class="admin-sections">
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-users-cog"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>
                        <div class="admin-users-list" id="admin-users-list">
                            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    
                    <!-- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-user-plus"></i> –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action primary large" id="btn-create-invite">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                            </button>
                            <div class="invites-list" id="invites-list">
                                <!-- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π -->
                                <div class="empty-chat">
                                    <i class="fas fa-envelope"></i>
                                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>
                                    <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-folder"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</h3>
                        <div class="sections-admin-list">
                            <div class="section-permissions">
                                <div class="permission-item">
                                    <span>–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç:</span>
                                    <select class="permission-select" data-section="main" data-permission="write">
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–ù–æ–≤–æ—Å—Ç–∏:</span>
                                    <select class="permission-select" data-section="news" data-permission="write">
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–ü—Ä–∞–≤–∏–ª–∞:</span>
                                    <select class="permission-select" data-section="rules" data-permission="write">
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                    </select>
                                </div>
                                <div class="permission-item">
                                    <span>–û–±—ä—è–≤–ª–µ–Ω–∏—è:</span>
                                    <select class="permission-select" data-section="announcements" data-permission="write">
                                        <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                        <option value="moderators">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã+</option>
                                        <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ê–¥–º–∏–Ω –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-tools"></i> –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action danger" id="btn-clear-chat">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
                            </button>
                            <button class="btn-admin-action primary" id="btn-export-data">
                                <i class="fas fa-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                            </button>
                            <button class="btn-admin-action primary" id="btn-create-backup">
                                <i class="fas fa-save"></i> –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <div class="settings-container" id="settings-view">
                <div class="admin-header">
                    <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–µ–±—è</p>
                </div>
                
                <div class="admin-sections">
                    <!-- –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-palette"></i> –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="dark-theme-toggle">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</div>
                                <select class="permission-select" id="font-size-select">
                                    <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                                    <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="large">–ë–æ–ª—å—à–æ–π</option>
                                </select>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–ê–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="auto-scroll-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-bell"></i> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–ó–≤—É–∫ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="sound-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–í–∏–±—Ä–æ—Å–∏–≥–Ω–∞–ª</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="vibration-toggle">
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–≤—å—é</div>
                                <label class="settings-toggle">
                                    <input type="checkbox" id="preview-toggle" checked>
                                    <span class="settings-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="stats-grid">
                            <div class="stats-card">
                                <div class="stats-number" id="stats-messages">0</div>
                                <div class="stats-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-users">1</div>
                                <div class="stats-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-sections">4</div>
                                <div class="stats-label">–†–∞–∑–¥–µ–ª–æ–≤</div>
                            </div>
                            <div class="stats-card">
                                <div class="stats-number" id="stats-online">1</div>
                                <div class="stats-label">–û–Ω–ª–∞–π–Ω</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
                    <div class="admin-section">
                        <h3><i class="fas fa-info-circle"></i> –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–í–µ—Ä—Å–∏—è</div>
                                <div class="settings-value">3.0.0</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</div>
                                <div class="settings-value">Botfs23 Team</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">Telegram WebApp</div>
                                <div class="settings-value">SDK v6.7</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="profile-container" id="profile-view">
                <div class="admin-header">
                    <h2><i class="fas fa-user"></i> –ü—Ä–æ—Ñ–∏–ª—å</h2>
                    <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ</p>
                </div>
                
                <div class="admin-sections">
                    <div class="admin-section">
                        <div class="user-profile" style="justify-content: center; margin-bottom: 30px;">
                            <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;">
                                <img id="profile-avatar-img" src="" alt="" onerror="hideProfileImage(this)" style="display: none;">
                                <i class="fas fa-user" id="profile-avatar-icon"></i>
                            </div>
                        </div>
                        
                        <div class="sections-admin-list">
                            <div class="settings-item">
                                <div class="settings-label">–ò–º—è</div>
                                <div class="settings-value" id="profile-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">Username</div>
                                <div class="settings-value" id="profile-username">@user</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">ID</div>
                                <div class="settings-value" id="profile-id">000000</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–†–æ–ª—å</div>
                                <div class="settings-value" id="profile-role">—É—á–∞—Å—Ç–Ω–∏–∫</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–°—Ç–∞—Ç—É—Å</div>
                                <div class="settings-value" id="profile-status">–æ–Ω–ª–∞–π–Ω</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–°–æ–æ–±—â–µ–Ω–∏–π</div>
                                <div class="settings-value" id="profile-messages">0</div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-label">–í —Å–µ—Ç–∏ —Å</div>
                                <div class="settings-value" id="profile-joined">—Å–µ–≥–æ–¥–Ω—è</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div class="admin-section">
                        <h3><i class="fas fa-user-edit"></i> –î–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="admin-actions">
                            <button class="btn-admin-action primary" id="btn-edit-profile">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                            </button>
                            <button class="btn-admin-action primary" id="btn-change-password">
                                <i class="fas fa-key"></i> –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                            </button>
                            <button class="btn-admin-action danger" id="btn-logout">
                                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø—ã –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    
    <!-- –†–µ–∞–∫—Ü–∏–∏ –ø–æ–ø–∞–ø -->
    <div class="reactions-popup" id="reactions-popup">
        <div class="reactions-options">
            <button class="reaction-option" data-emoji="üëç">üëç</button>
            <button class="reaction-option" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
            <button class="reaction-option" data-emoji="üòÇ">üòÇ</button>
            <button class="reaction-option" data-emoji="üòÆ">üòÆ</button>
            <button class="reaction-option" data-emoji="üò¢">üò¢</button>
            <button class="reaction-option" data-emoji="üò°">üò°</button>
            <button class="reaction-option" data-emoji="üéâ">üéâ</button>
            <button class="reaction-option" data-emoji="üî•">üî•</button>
            <button class="reaction-option" data-emoji="üëè">üëè</button>
            <button class="reaction-option" data-emoji="üôè">üôè</button>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="message-context-menu" id="message-context-menu">
        <div class="context-menu-item" data-action="reply">
            <i class="fas fa-reply"></i>
            <span>–û—Ç–≤–µ—Ç–∏—Ç—å</span>
        </div>
        <div class="context-menu-item" data-action="copy">
            <i class="fas fa-copy"></i>
            <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</span>
        </div>
        <div class="context-menu-item" data-action="copy-link">
            <i class="fas fa-link"></i>
            <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</span>
        </div>
        <div class="context-menu-item" data-action="favorite">
            <i class="fas fa-star"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </div>
        <div class="context-menu-item" data-action="forward">
            <i class="fas fa-share"></i>
            <span>–ü–µ—Ä–µ—Å–ª–∞—Ç—å</span>
        </div>
        <div class="context-menu-item" data-action="reaction">
            <i class="far fa-smile"></i>
            <span>–†–µ–∞–∫—Ü–∏—è</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="edit">
            <i class="fas fa-edit"></i>
            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
        </div>
        <div class="context-menu-item" data-action="delete">
            <i class="fas fa-trash"></i>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="report">
            <i class="fas fa-flag"></i>
            <span>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</span>
        </div>
        <div class="context-menu-item" data-action="select">
            <i class="fas fa-check-square"></i>
            <span>–í—ã–±—Ä–∞—Ç—å</span>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ -->
    <div class="forward-popup" id="forward-popup">
        <div class="forward-header">
            <h3>–ü–µ—Ä–µ—Å–ª–∞—Ç—å –≤...</h3>
            <button class="btn-close-forward" id="btn-close-forward">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="forward-options" id="forward-options">
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="upload-progress" id="upload-progress">
        <div id="upload-text">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%;"></div>
        </div>
    </div>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞ -->
    <div class="file-preview" id="file-preview">
        <div class="file-preview-content">
            <div class="file-preview-icon">
                <i class="fas fa-file"></i>
            </div>
            <div class="file-preview-info">
                <div class="file-preview-name" id="file-preview-name">file.pdf</div>
                <div class="file-preview-size" id="file-preview-size">2.4 MB</div>
            </div>
            <div class="file-preview-actions">
                <button class="btn-admin-action primary" id="btn-send-file">
                    <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
                <button class="btn-admin-action danger" id="btn-cancel-file">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –¢–æ–≥–≥–ª–µ—Ä —Ç–µ–º—ã -->
    <button class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const APP = {
            currentView: 'chat',
            currentSection: 'main',
            activeMessageMenu: null,
            userData: null,
            settings: {
                darkTheme: false,
                fontSize: 'medium',
                autoScroll: true,
                soundEnabled: true,
                vibrationEnabled: false,
                previewEnabled: true
            }
        };
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            loadingScreen: document.getElementById('loading-screen'),
            telegramApp: document.getElementById('telegram-app'),
            sidebar: document.getElementById('sidebar'),
            overlay: document.getElementById('overlay'),
            chatView: document.getElementById('chat-view'),
            usersView: document.getElementById('users-view'),
            adminView: document.getElementById('admin-view'),
            settingsView: document.getElementById('settings-view'),
            profileView: document.getElementById('profile-view'),
            messagesContainer: document.getElementById('messages-container'),
            messageInput: document.getElementById('message-input'),
            sendButton: document.getElementById('send-button'),
            attachMenu: document.getElementById('attach-menu'),
            emojiPicker: document.getElementById('emoji-picker'),
            usersList: document.getElementById('users-list'),
            usersSearchInput: document.getElementById('users-search-input'),
            reactionsPopup: document.getElementById('reactions-popup'),
            messageContextMenu: document.getElementById('message-context-menu'),
            forwardPopup: document.getElementById('forward-popup'),
            uploadProgress: document.getElementById('upload-progress'),
            filePreview: document.getElementById('file-preview'),
            themeToggle: document.getElementById('theme-toggle'),
            themeIcon: document.getElementById('theme-icon'),
            darkThemeToggle: document.getElementById('dark-theme-toggle'),
            fontSizeSelect: document.getElementById('font-size-select'),
            autoScrollToggle: document.getElementById('auto-scroll-toggle'),
            soundToggle: document.getElementById('sound-toggle'),
            vibrationToggle: document.getElementById('vibration-toggle'),
            previewToggle: document.getElementById('preview-toggle'),
            adminMenuItem: document.getElementById('admin-menu-item'),
            btnAdmin: document.getElementById('btn-admin'),
            btnMentionAll: document.getElementById('btn-mention-all')
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            loadSettings();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            initTelegramWebApp();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö
            loadDemoData();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();
            
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('tgChatSettings');
            if (savedSettings) {
                APP.settings = { ...APP.settings, ...JSON.parse(savedSettings) };
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            applySettings();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
        function saveSettings() {
            localStorage.setItem('tgChatSettings', JSON.stringify(APP.settings));
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function applySettings() {
            // –¢–µ–º–∞
            if (APP.settings.darkTheme) {
                document.body.classList.add('dark-theme');
                elements.themeIcon.className = 'fas fa-sun';
            } else {
                document.body.classList.remove('dark-theme');
                elements.themeIcon.className = 'fas fa-moon';
            }
            
            // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
            const fontSizeMap = {
                small: '13px',
                medium: '14px',
                large: '16px'
            };
            document.body.style.fontSize = fontSizeMap[APP.settings.fontSize] || '14px';
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            elements.darkThemeToggle.checked = APP.settings.darkTheme;
            elements.fontSizeSelect.value = APP.settings.fontSize;
            elements.autoScrollToggle.checked = APP.settings.autoScroll;
            elements.soundToggle.checked = APP.settings.soundEnabled;
            elements.vibrationToggle.checked = APP.settings.vibrationEnabled;
            elements.previewToggle.checked = APP.settings.previewEnabled;
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ú–µ–Ω—é
            document.getElementById('btn-menu').addEventListener('click', toggleSidebar);
            document.getElementById('btn-close-sidebar').addEventListener('click', toggleSidebar);
            elements.overlay.addEventListener('click', toggleSidebar);
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    const view = item.dataset.view;
                    switchView(view);
                });
            });
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
            document.querySelectorAll('.section-item').forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.dataset.section;
                    switchSection(section);
                    toggleSidebar();
                });
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            elements.sendButton.addEventListener('click', sendMessage);
            elements.messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // –ê–≤—Ç–æ-—Ä–∞–∑–º–µ—Ä textarea
            elements.messageInput.addEventListener('input', autoResizeTextarea);
            
            // –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
            document.getElementById('btn-attach').addEventListener('click', toggleAttachMenu);
            document.querySelectorAll('.attach-item').forEach(item => {
                item.addEventListener('click', () => {
                    const type = item.dataset.type;
                    attachFile(type);
                });
            });
            
            // –≠–º–æ–¥–∑–∏
            document.getElementById('btn-emoji').addEventListener('click', toggleEmojiPicker);
            document.querySelectorAll('.emoji-category').forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.dataset.category;
                    showEmojiCategory(category);
                });
            });
            
            // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            elements.usersSearchInput.addEventListener('input', (e) => {
                searchUsers(e.target.value);
            });
            document.getElementById('btn-close-search').addEventListener('click', () => {
                elements.usersSearchInput.value = '';
                searchUsers('');
            });
            
            // –ö–Ω–æ–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            document.getElementById('btn-users').addEventListener('click', () => switchView('users'));
            
            // –ö–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∫–∏
            document.getElementById('btn-admin').addEventListener('click', () => switchView('admin'));
            document.getElementById('btn-create-invite').addEventListener('click', createInvite);
            document.getElementById('btn-clear-chat').addEventListener('click', clearChatHistory);
            document.getElementById('btn-export-data').addEventListener('click', exportChatData);
            document.getElementById('btn-create-backup').addEventListener('click', createBackup);
            
            // –ö–Ω–æ–ø–∫–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
            document.getElementById('btn-mention-all').addEventListener('click', mentionAll);
            document.getElementById('btn-jump').addEventListener('click', jumpToUnread);
            
            // –†–µ–∞–∫—Ü–∏–∏
            document.querySelectorAll('.reaction-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    const emoji = btn.dataset.emoji;
                    addReaction(emoji);
                });
            });
            
            // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏–π
            document.querySelectorAll('.context-menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    const action = item.dataset.action;
                    handleContextMenuAction(action);
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–æ–≤
            document.getElementById('btn-close-forward').addEventListener('click', closeForwardPopup);
            
            // –§–∞–π–ª—ã
            document.getElementById('btn-send-file').addEventListener('click', sendFile);
            document.getElementById('btn-cancel-file').addEventListener('click', cancelFile);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            elements.themeToggle.addEventListener('click', toggleTheme);
            elements.darkThemeToggle.addEventListener('change', toggleTheme);
            elements.fontSizeSelect.addEventListener('change', changeFontSize);
            elements.autoScrollToggle.addEventListener('change', toggleAutoScroll);
            elements.soundToggle.addEventListener('change', toggleSound);
            elements.vibrationToggle.addEventListener('change', toggleVibration);
            elements.previewToggle.addEventListener('change', togglePreview);
            
            // –ü—Ä–æ—Ñ–∏–ª—å
            document.getElementById('btn-edit-profile').addEventListener('click', editProfile);
            document.getElementById('btn-change-password').addEventListener('click', changePassword);
            document.getElementById('btn-logout').addEventListener('click', logout);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
            document.addEventListener('click', (e) => {
                if (!elements.attachMenu.contains(e.target) && 
                    !e.target.closest('.btn-attach')) {
                    elements.attachMenu.classList.remove('active');
                }
                
                if (!elements.emojiPicker.contains(e.target) && 
                    !e.target.closest('.btn-emoji')) {
                    elements.emojiPicker.classList.remove('active');
                }
                
                if (!elements.messageContextMenu.contains(e.target) && 
                    !e.target.closest('.btn-more')) {
                    elements.messageContextMenu.style.display = 'none';
                }
                
                if (!elements.reactionsPopup.contains(e.target) && 
                    !e.target.closest('.btn-reaction')) {
                    elements.reactionsPopup.style.display = 'none';
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            window.addEventListener('error', handleError);
            window.addEventListener('unhandledrejection', handleUnhandledRejection);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.expand();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    APP.userData = user;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                    updateUserProfile(user);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
                    checkUserPermissions(user);
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ç–µ–º—ã Telegram
                if (tg.colorScheme) {
                    if (tg.colorScheme === 'dark') {
                        APP.settings.darkTheme = true;
                        applySettings();
                    }
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
                tg.onEvent('viewportChanged', () => {
                    console.log('Viewport changed');
                });
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥
                tg.BackButton.onClick(() => {
                    if (APP.currentView !== 'chat') {
                        switchView('chat');
                    } else {
                        tg.close();
                    }
                });
                
                console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                console.warn('Telegram WebApp SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, —Ä–∞–±–æ—Ç–∞–µ–º –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ');
                // –î–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                APP.userData = {
                    id: 123456789,
                    first_name: '–î–µ–º–æ',
                    last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    username: 'demo_user',
                    photo_url: '',
                    is_premium: false
                };
                updateUserProfile(APP.userData);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserProfile(user) {
            // –ê–≤–∞—Ç–∞—Ä
            const avatarImg = document.getElementById('user-avatar-img');
            const avatarIcon = document.getElementById('user-avatar-icon');
            const profileAvatarImg = document.getElementById('profile-avatar-img');
            const profileAvatarIcon = document.getElementById('profile-avatar-icon');
            
            if (user.photo_url) {
                avatarImg.src = user.photo_url;
                avatarImg.style.display = 'block';
                avatarIcon.style.display = 'none';
                
                profileAvatarImg.src = user.photo_url;
                profileAvatarImg.style.display = 'block';
                profileAvatarIcon.style.display = 'none';
            }
            
            // –ò–º—è
            const userName = user.first_name + (user.last_name ? ' ' + user.last_name : '');
            document.getElementById('user-name').textContent = userName;
            document.getElementById('profile-name').textContent = userName;
            
            // Username
            const username = user.username ? '@' + user.username : '@user';
            document.getElementById('profile-username').textContent = username;
            
            // ID
            document.getElementById('profile-id').textContent = user.id;
            
            // –ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å
            if (user.is_premium) {
                const roleElement = document.getElementById('user-role');
                roleElement.textContent = '–ø—Ä–µ–º–∏—É–º —É—á–∞—Å—Ç–Ω–∏–∫';
                roleElement.style.color = 'var(--tg-yellow)';
            }
            
            // –ü—Ä–æ—Ñ–∏–ª—å
            updateProfileInfo();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function checkUserPermissions(user) {
            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –¥–µ–ª–∞–µ–º –∞–¥–º–∏–Ω–æ–º
            const isAdmin = user.id === 123456789; // –î–µ–º–æ-–∞–¥–º–∏–Ω
            const isModerator = user.id === 987654321; // –î–µ–º–æ-–º–æ–¥–µ—Ä–∞—Ç–æ—Ä
            
            if (isAdmin || isModerator) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                elements.adminMenuItem.style.display = 'flex';
                elements.btnAdmin.style.display = 'flex';
                elements.btnMentionAll.style.display = 'flex';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–ª—å
                const role = isAdmin ? '–≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä';
                document.getElementById('user-role').textContent = role;
                document.getElementById('profile-role').textContent = role;
                
                // –¶–≤–µ—Ç —Ä–æ–ª–∏
                const roleColor = isAdmin ? 'linear-gradient(135deg, #ff9500, #ff5e3a)' : 'var(--tg-purple)';
                document.getElementById('user-role').style.background = roleColor;
                document.getElementById('user-role').style.color = 'white';
                document.getElementById('user-role').style.padding = '2px 8px';
                document.getElementById('user-role').style.borderRadius = '4px';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö
        function loadDemoData() {
            // –î–µ–º–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            addDemoMessages();
            
            // –î–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            addDemoUsers();
            
            // –î–µ–º–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            addDemoInvites();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        function addDemoMessages() {
            const demoMessages = [
                {
                    id: 1,
                    sender: '–°–∏—Å—Ç–µ–º–∞',
                    avatar: 'B',
                    role: 'system',
                    text: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç Botfs23! –≠—Ç–æ –¥–µ–º–æ-—Ä–µ–∂–∏–º.',
                    time: '10:00',
                    incoming: true,
                    system: true
                },
                {
                    id: 2,
                    sender: '–î–µ–º–æ –ê–¥–º–∏–Ω',
                    avatar: 'A',
                    role: 'main_admin',
                    text: '–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —ç—Ç–æ–≥–æ —á–∞—Ç–∞.',
                    time: '10:05',
                    incoming: false,
                    reactions: { 'üëç': 2, '‚ù§Ô∏è': 1 }
                },
                {
                    id: 3,
                    sender: '–î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    avatar: 'U',
                    role: 'user',
                    text: '–ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω—ã–π —á–∞—Ç! –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª?',
                    time: '10:10',
                    incoming: true,
                    mention: '@admin'
                },
                {
                    id: 4,
                    sender: '–î–µ–º–æ –ê–¥–º–∏–Ω',
                    avatar: 'A',
                    role: 'main_admin',
                    text: '–§–∞–π–ª—ã –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–∂–µ —Å–µ–π—á–∞—Å! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–∫—Ä–µ–ø–∫—É —Ä—è–¥–æ–º —Å –ø–æ–ª–µ–º –≤–≤–æ–¥–∞.',
                    time: '10:15',
                    incoming: false,
                    replyTo: 3
                },
                {
                    id: 5,
                    sender: '–î–µ–º–æ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
                    avatar: 'M',
                    role: 'moderator',
                    text: '–ù–∞–ø–æ–º–∏–Ω–∞—é –ø—Ä–∞–≤–∏–ª–∞: –±—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ —É–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞!',
                    time: '10:20',
                    incoming: true,
                    isPinned: true
                }
            ];
            
            const messagesContainer = elements.messagesContainer;
            messagesContainer.innerHTML = '';
            
            demoMessages.forEach(msg => {
                const messageElement = createMessageElement(msg);
                messagesContainer.appendChild(messageElement);
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            if (APP.settings.autoScroll) {
                scrollToBottom();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function createMessageElement(message) {
            const isOutgoing = !message.incoming;
            const isSystem = message.system;
            const messageClass = isSystem ? 'message system' : `message ${isOutgoing ? 'outgoing' : 'incoming'}`;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = messageClass;
            messageDiv.dataset.id = message.id;
            
            if (isSystem) {
                messageDiv.innerHTML = `
                    <div class="message-system">
                        <i class="fas fa-info-circle"></i>
                        <span>${message.text}</span>
                    </div>
                `;
            } else {
                // –ê–≤–∞—Ç–∞—Ä
                const avatarHtml = isOutgoing ? '' : `
                    <div class="message-avatar" style="background: ${getAvatarColor(message.sender)};">
                        ${message.avatar}
                    </div>
                `;
                
                // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                const headerHtml = isOutgoing ? '' : `
                    <div class="message-header">
                        <div class="message-sender">
                            <span>${message.sender}</span>
                            ${message.role ? `<span class="message-sender-role ${message.role}">${getRoleText(message.role)}</span>` : ''}
                        </div>
                        <div class="message-time">${message.time}</div>
                    </div>
                `;
                
                // –¢–µ–∫—Å—Ç —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏
                let text = message.text;
                if (message.mention) {
                    text = text.replace(message.mention, `<span class="mention">${message.mention}</span>`);
                }
                
                // –†–µ–∞–∫—Ü–∏–∏
                let reactionsHtml = '';
                if (message.reactions) {
                    reactionsHtml = `
                        <div class="message-reactions">
                            ${Object.entries(message.reactions).map(([emoji, count]) => `
                                <div class="reaction ${message.myReaction === emoji ? 'user-reacted' : ''}" 
                                     onclick="toggleReaction(${message.id}, '${emoji}')">
                                    <span>${emoji}</span>
                                    <span class="reaction-count">${count}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // –î–µ–π—Å—Ç–≤–∏—è
                const actionsHtml = `
                    <div class="message-actions">
                        <button class="btn-reaction" onclick="showReactionPopup(${message.id})">
                            <i class="far fa-smile"></i>
                        </button>
                        <button class="btn-reply" onclick="replyToMessage(${message.id})">
                            <i class="fas fa-reply"></i>
                        </button>
                        <button class="btn-forward" onclick="forwardMessage(${message.id})">
                            <i class="fas fa-share"></i>
                        </button>
                        <button class="btn-more" onclick="showMessageMenu(${message.id})">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                `;
                
                // –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
                const statusHtml = isOutgoing ? `
                    <div class="message-status">
                        <i class="fas fa-check"></i>
                        <span>${message.time}</span>
                    </div>
                ` : '';
                
                messageDiv.innerHTML = `
                    ${avatarHtml}
                    <div class="message-content">
                        ${headerHtml}
                        <div class="message-text">${text}</div>
                        ${reactionsHtml}
                        ${actionsHtml}
                        ${statusHtml}
                    </div>
                `;
                
                // –ü–∏–Ω
                if (message.isPinned) {
                    messageDiv.classList.add('pinned');
                }
                
                // –û—Ç–≤–µ—Ç
                if (message.replyTo) {
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞
                }
            }
            
            return messageDiv;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
        function getAvatarColor(senderName) {
            const colors = [
                'var(--tg-primary)',
                'var(--tg-green)',
                'var(--tg-red)',
                'var(--tg-orange)',
                'var(--tg-purple)',
                'var(--tg-pink)'
            ];
            const hash = senderName.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            return colors[hash % colors.length];
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–æ–ª–∏
        function getRoleText(role) {
            const roles = {
                'main_admin': '–ì–ª. –ê–¥–º–∏–Ω',
                'admin': '–ê–¥–º–∏–Ω',
                'moderator': '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
                'user': '–£—á–∞—Å—Ç–Ω–∏–∫'
            };
            return roles[role] || role;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function addDemoUsers() {
            const demoUsers = [
                {
                    id: 123456789,
                    name: '–î–µ–º–æ –ê–¥–º–∏–Ω',
                    username: '@admin',
                    role: 'main_admin',
                    status: 'online',
                    avatar: 'A',
                    messages: 42
                },
                {
                    id: 987654321,
                    name: '–î–µ–º–æ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
                    username: '@moderator',
                    role: 'moderator',
                    status: 'online',
                    avatar: 'M',
                    messages: 24
                },
                {
                    id: 555555555,
                    name: '–î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    username: '@user',
                    role: 'user',
                    status: 'online',
                    avatar: 'U',
                    messages: 15
                },
                {
                    id: 666666666,
                    name: '–ê–ª–µ–∫—Å–µ–π',
                    username: '@alexey',
                    role: 'user',
                    status: '–±—ã–ª 5 –º–∏–Ω –Ω–∞–∑–∞–¥',
                    avatar: '–ê',
                    messages: 8
                },
                {
                    id: 777777777,
                    name: '–ú–∞—Ä–∏—è',
                    username: '@maria',
                    role: 'user',
                    status: '–±—ã–ª 1 —á–∞—Å –Ω–∞–∑–∞–¥',
                    avatar: '–ú',
                    messages: 12
                },
                {
                    id: 888888888,
                    name: '–ò–≤–∞–Ω',
                    username: '@ivan',
                    role: 'user',
                    status: '–±—ã–ª 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥',
                    avatar: '–ò',
                    messages: 5
                }
            ];
            
            APP.users = demoUsers;
            renderUsersList(demoUsers);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            updateOnlineCount();
        }
        
        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function renderUsersList(users) {
            const usersList = elements.usersList;
            const adminUsersList = document.getElementById('admin-users-list');
            
            usersList.innerHTML = '';
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –æ–Ω–ª–∞–π–Ω –∏ –æ—Ñ–ª–∞–π–Ω
            const onlineUsers = users.filter(u => u.status === 'online');
            const offlineUsers = users.filter(u => u.status !== 'online');
            
            // –û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            if (onlineUsers.length > 0) {
                const onlineHeader = document.createElement('div');
                onlineHeader.className = 'users-header-title';
                onlineHeader.innerHTML = `<i class="fas fa-circle online-dot"></i> –û–Ω–ª–∞–π–Ω (${onlineUsers.length})`;
                usersList.appendChild(onlineHeader);
                
                onlineUsers.forEach(user => {
                    const userElement = createUserElement(user);
                    usersList.appendChild(userElement);
                });
            }
            
            // –û—Ñ–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            if (offlineUsers.length > 0) {
                const offlineHeader = document.createElement('div');
                offlineHeader.className = 'users-header-title';
                offlineHeader.innerHTML = `<i class="fas fa-clock"></i> –ù–µ –≤ —Å–µ—Ç–∏ (${offlineUsers.length})`;
                usersList.appendChild(offlineHeader);
                
                offlineUsers.forEach(user => {
                    const userElement = createUserElement(user);
                    usersList.appendChild(userElement);
                });
            }
            
            // –ê–¥–º–∏–Ω —Å–ø–∏—Å–æ–∫
            if (adminUsersList) {
                adminUsersList.innerHTML = '';
                users.forEach(user => {
                    const adminUserElement = createAdminUserElement(user);
                    adminUsersList.appendChild(adminUserElement);
                });
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function createUserElement(user) {
            const userDiv = document.createElement('div');
            userDiv.className = 'user-item';
            userDiv.dataset.id = user.id;
            
            const isOnline = user.status === 'online';
            
            userDiv.innerHTML = `
                <div class="user-item-avatar" style="background: ${getAvatarColor(user.name)};">
                    ${user.avatar}
                </div>
                <div class="user-item-info">
                    <div class="user-item-name">
                        <span>${user.name}</span>
                        <span class="user-role-badge ${user.role}">${getRoleText(user.role)}</span>
                    </div>
                    <div class="user-item-status ${isOnline ? 'online' : ''}">
                        ${isOnline ? '<i class="fas fa-circle"></i> –æ–Ω–ª–∞–π–Ω' : user.status}
                    </div>
                </div>
            `;
            
            return userDiv;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function createAdminUserElement(user) {
            const userDiv = document.createElement('div');
            userDiv.className = 'admin-user-item';
            userDiv.dataset.id = user.id;
            
            const isOnline = user.status === 'online';
            
            userDiv.innerHTML = `
                <div class="admin-user-info">
                    <div class="admin-user-avatar" style="background: ${getAvatarColor(user.name)};">
                        ${user.avatar}
                    </div>
                    <div>
                        <div class="admin-user-name">
                            <span>${user.name}</span>
                            <span class="user-role-badge ${user.role}">${getRoleText(user.role)}</span>
                        </div>
                        <div class="admin-user-id">ID: ${user.id}</div>
                    </div>
                </div>
                <div class="admin-user-actions">
                    <select class="permission-select" onchange="updateUserRole(${user.id}, this.value)">
                        <option value="user" ${user.role === 'user' ? 'selected' : ''}>–£—á–∞—Å—Ç–Ω–∏–∫</option>
                        <option value="moderator" ${user.role === 'moderator' ? 'selected' : ''}>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                        <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>–ê–¥–º–∏–Ω</option>
                    </select>
                    <span class="admin-user-status ${isOnline ? 'online' : 'offline'}">
                        ${isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω'}
                    </span>
                </div>
            `;
            
            return userDiv;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
        function addDemoInvites() {
            const demoInvites = [
                {
                    code: 'BOTFS23-WELCOME',
                    uses: 15,
                    maxUses: 50,
                    created: '2024-01-15',
                    creator: '–î–µ–º–æ –ê–¥–º–∏–Ω'
                },
                {
                    code: 'BOTFS23-FRIENDS',
                    uses: 3,
                    maxUses: 10,
                    created: '2024-01-20',
                    creator: '–î–µ–º–æ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä'
                }
            ];
            
            renderInvitesList(demoInvites);
        }
        
        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
        function renderInvitesList(invites) {
            const invitesList = document.getElementById('invites-list');
            
            if (invites.length === 0) {
                invitesList.innerHTML = `
                    <div class="empty-chat">
                        <i class="fas fa-envelope"></i>
                        <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>
                        <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</small>
                    </div>
                `;
                return;
            }
            
            invitesList.innerHTML = invites.map(invite => `
                <div class="invite-item">
                    <div>
                        <div class="invite-code">${invite.code}</div>
                        <div class="invite-stats">
                            –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${invite.uses}/${invite.maxUses} | –°–æ–∑–¥–∞–Ω–æ: ${invite.created}
                        </div>
                    </div>
                    <button class="btn-copy-invite" onclick="copyInviteCode('${invite.code}')">
                        <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            `).join('');
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function searchUsers(query) {
            if (!APP.users) return;
            
            const normalizedQuery = query.toLowerCase().trim();
            
            if (!normalizedQuery) {
                renderUsersList(APP.users);
                return;
            }
            
            const filteredUsers = APP.users.filter(user => 
                user.name.toLowerCase().includes(normalizedQuery) ||
                user.username.toLowerCase().includes(normalizedQuery) ||
                user.role.toLowerCase().includes(normalizedQuery)
            );
            
            renderUsersList(filteredUsers);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
        function switchView(view) {
            APP.currentView = view;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∏–¥—ã
            elements.chatView.classList.remove('active');
            elements.chatView.style.display = 'none';
            elements.usersView.classList.remove('active');
            elements.usersView.style.display = 'none';
            elements.adminView.classList.remove('active');
            elements.adminView.style.display = 'none';
            elements.settingsView.classList.remove('active');
            elements.settingsView.style.display = 'none';
            elements.profileView.classList.remove('active');
            elements.profileView.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∏–¥
            switch(view) {
                case 'chat':
                    elements.chatView.classList.add('active');
                    elements.chatView.style.display = 'flex';
                    updateMenuActive(0);
                    if (APP.settings.autoScroll) {
                        setTimeout(() => scrollToBottom(), 100);
                    }
                    break;
                    
                case 'users':
                    elements.usersView.classList.add('active');
                    elements.usersView.style.display = 'flex';
                    updateMenuActive(1);
                    searchUsers('');
                    break;
                    
                case 'admin':
                    elements.adminView.classList.add('active');
                    elements.adminView.style.display = 'flex';
                    updateMenuActive(2);
                    break;
                    
                case 'settings':
                    elements.settingsView.classList.add('active');
                    elements.settingsView.style.display = 'flex';
                    updateMenuActive(3);
                    updateStats();
                    break;
                    
                case 'profile':
                    elements.profileView.classList.add('active');
                    elements.profileView.style.display = 'flex';
                    updateMenuActive(4);
                    updateProfileInfo();
                    break;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ø–∞–ø—ã
            hideAllPopups();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞
        function switchSection(sectionId) {
            APP.currentSection = sectionId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            document.querySelectorAll('.section-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === sectionId);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            const sectionNames = {
                main: '–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç',
                news: '–ù–æ–≤–æ—Å—Ç–∏',
                rules: '–ü—Ä–∞–≤–∏–ª–∞',
                announcements: '–û–±—ä—è–≤–ª–µ–Ω–∏—è'
            };
            
            document.getElementById('chat-title').textContent = sectionNames[sectionId] || '–ß–∞—Ç';
            
            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Ä–∞–∑–¥–µ–ª–∞
            // loadSectionMessages(sectionId);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showCustomAlert(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ —Ä–∞–∑–¥–µ–ª: ${sectionNames[sectionId]}`, 'info');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é
        function updateMenuActive(activeIndex) {
            document.querySelectorAll('.menu-item').forEach((item, index) => {
                item.classList.toggle('active', index === activeIndex);
            });
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = elements.messageInput;
            const text = input.value.trim();
            
            if (!text) return;
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            const newMessage = {
                id: Date.now(),
                sender: APP.userData?.first_name || '–í—ã',
                avatar: APP.userData?.first_name?.charAt(0) || '–Ø',
                role: 'user', // –≠—Ç–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∞–≤
                text: text,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                incoming: false
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
            addMessageToChat(newMessage);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            autoResizeTextarea();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            if (APP.settings.autoScroll) {
                scrollToBottom();
            }
            
            // –ó–≤—É–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
            if (APP.settings.soundEnabled) {
                playMessageSound();
            }
            
            console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:', text);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessageToChat(message) {
            const messageElement = createMessageElement(message);
            elements.messagesContainer.appendChild(messageElement);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
            messageElement.classList.add('new-message');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
        }
        
        // –ê–≤—Ç–æ-—Ä–∞–∑–º–µ—Ä textarea
        function autoResizeTextarea() {
            const textarea = elements.messageInput;
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }
        
        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
        function scrollToBottom() {
            const container = elements.messagesContainer;
            container.scrollTop = container.scrollHeight;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–∞
        function toggleSidebar() {
            elements.sidebar.classList.toggle('active');
            elements.overlay.classList.toggle('active');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–Ω—é –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è
        function toggleAttachMenu() {
            elements.attachMenu.classList.toggle('active');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä–∞
        function toggleEmojiPicker() {
            elements.emojiPicker.classList.toggle('active');
            
            if (elements.emojiPicker.classList.contains('active')) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
                if (!elements.emojiPicker.dataset.loaded) {
                    loadEmojis();
                    elements.emojiPicker.dataset.loaded = 'true';
                }
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —ç–º–æ–¥–∑–∏
        function loadEmojis() {
            const emojis = {
                smileys: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö'],
                people: ['üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëå', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', 'üëç', 'üëé', '‚úä'],
                symbols: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü'],
                nature: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî'],
                food: ['üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'ü•ì', 'ü•ö', 'üç≥', 'üßá', 'ü•û', 'üßà', 'üçû', 'ü•ê', 'ü•®', 'ü•Ø', 'ü•ñ', 'üßÄ', 'ü•ó', 'ü•ô', 'üåÆ']
            };
            
            const grid = document.getElementById('emoji-grid');
            grid.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–º–∞–π–ª–∏–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            showEmojiCategory('smileys');
        }
        
        // –ü–æ–∫–∞–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —ç–º–æ–¥–∑–∏
        function showEmojiCategory(category) {
            const categories = {
                smileys: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö'],
                people: ['üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëå', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', 'üëç', 'üëé', '‚úä'],
                symbols: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü'],
                nature: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî'],
                food: ['üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'ü•ì', 'ü•ö', 'üç≥', 'üßá', 'ü•û', 'üßà', 'üçû', 'ü•ê', 'ü•®', 'ü•Ø', 'ü•ñ', 'üßÄ', 'ü•ó', 'ü•ô', 'üåÆ']
            };
            
            const emojis = categories[category] || categories.smileys;
            const grid = document.getElementById('emoji-grid');
            
            grid.innerHTML = emojis.map(emoji => `
                <button class="emoji-option" data-emoji="${emoji}">${emoji}</button>
            `).join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            document.querySelectorAll('.emoji-category').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.category === category);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–º–æ–¥–∑–∏
            document.querySelectorAll('.emoji-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    const emoji = btn.dataset.emoji;
                    insertEmoji(emoji);
                });
            });
        }
        
        // –í—Å—Ç–∞–≤–∫–∞ —ç–º–æ–¥–∑–∏ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        function insertEmoji(emoji) {
            const input = elements.messageInput;
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + emoji + textAfter;
            input.focus();
            input.selectionStart = input.selectionEnd = cursorPos + emoji.length;
            
            autoResizeTextarea();
            toggleEmojiPicker();
        }
        
        // –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        function attachFile(type) {
            toggleAttachMenu();
            
            switch(type) {
                case 'photo':
                    // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ
                    simulateFileSelect('photo', 'example.jpg', '2.1 MB');
                    break;
                    
                case 'document':
                    // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
                    simulateFileSelect('document', '–¥–æ–∫—É–º–µ–Ω—Ç.pdf', '1.8 MB');
                    break;
                    
                case 'sticker':
                    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞
                    sendSticker();
                    break;
                    
                case 'voice':
                    // –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ
                    recordVoice();
                    break;
            }
        }
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function simulateFileSelect(type, name, size) {
            const fileType = type === 'photo' ? 'image/jpeg' : 'application/pdf';
            const icon = type === 'photo' ? 'fas fa-image' : 'fas fa-file';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
            document.getElementById('file-preview-name').textContent = name;
            document.getElementById('file-preview-size').textContent = size;
            document.querySelector('.file-preview-icon i').className = icon;
            elements.filePreview.classList.add('active');
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            showUploadProgress();
            simulateUpload();
        }
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        function simulateUpload() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                updateProgress(progress);
                
                if (progress >= 100) {
                    clearInterval(interval);
                    hideUploadProgress();
                }
            }, 100);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞
        function sendSticker() {
            const stickers = ['üòÇ', 'üòç', 'ü§î', 'üéâ', 'üî•', 'üëç', '‚ù§Ô∏è', 'üôè'];
            const randomSticker = stickers[Math.floor(Math.random() * stickers.length)];
            
            const stickerMessage = {
                id: Date.now(),
                sender: APP.userData?.first_name || '–í—ã',
                avatar: APP.userData?.first_name?.charAt(0) || '–Ø',
                role: 'user',
                type: 'sticker',
                sticker: randomSticker,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                incoming: false
            };
            
            addStickerToChat(stickerMessage);
            showCustomAlert('–°—Ç–∏–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 'success');
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–∫–µ—Ä–∞ –≤ —á–∞—Ç
        function addStickerToChat(stickerMessage) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${stickerMessage.incoming ? 'incoming' : 'outgoing'}`;
            messageDiv.dataset.id = stickerMessage.id;
            
            messageDiv.innerHTML = `
                <div class="message-content" style="text-align: center;">
                    <div class="message-sticker" style="font-size: 64px;">
                        ${stickerMessage.sticker}
                    </div>
                    <div class="message-time" style="text-align: center; margin-top: 5px; opacity: 0.7;">
                        ${stickerMessage.time}
                    </div>
                </div>
            `;
            
            elements.messagesContainer.appendChild(messageDiv);
            
            if (APP.settings.autoScroll) {
                scrollToBottom();
            }
        }
        
        // –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ
        function recordVoice() {
            showCustomAlert('–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞
        function sendFile() {
            const fileName = document.getElementById('file-preview-name').textContent;
            
            const fileMessage = {
                id: Date.now(),
                sender: APP.userData?.first_name || '–í—ã',
                avatar: APP.userData?.first_name?.charAt(0) || '–Ø',
                role: 'user',
                type: 'document',
                fileName: fileName,
                fileSize: document.getElementById('file-preview-size').textContent,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                incoming: false
            };
            
            addFileToChat(fileMessage);
            elements.filePreview.classList.remove('active');
            showCustomAlert('–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 'success');
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ —á–∞—Ç
        function addFileToChat(fileMessage) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${fileMessage.incoming ? 'incoming' : 'outgoing'}`;
            messageDiv.dataset.id = fileMessage.id;
            
            const avatarHtml = fileMessage.incoming ? `
                <div class="message-avatar" style="background: ${getAvatarColor(fileMessage.sender)};">
                    ${fileMessage.avatar}
                </div>
            ` : '';
            
            messageDiv.innerHTML = `
                ${avatarHtml}
                <div class="message-content">
                    ${fileMessage.incoming ? `
                        <div class="message-header">
                            <div class="message-sender">
                                <span>${fileMessage.sender}</span>
                                ${fileMessage.role ? `<span class="message-sender-role ${fileMessage.role}">${getRoleText(fileMessage.role)}</span>` : ''}
                            </div>
                        </div>
                    ` : ''}
                    <div class="message-document">
                        <i class="fas fa-file"></i>
                        <div class="document-info">
                            <div class="document-name">${fileMessage.fileName}</div>
                            <div class="document-size">${fileMessage.fileSize}</div>
                        </div>
                        <button class="download-btn">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div class="message-time" style="margin-top: 5px; text-align: ${fileMessage.incoming ? 'left' : 'right'}">
                        ${fileMessage.time}
                    </div>
                </div>
            `;
            
            elements.messagesContainer.appendChild(messageDiv);
            
            if (APP.settings.autoScroll) {
                scrollToBottom();
            }
        }
        
        // –û—Ç–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞
        function cancelFile() {
            elements.filePreview.classList.remove('active');
            hideUploadProgress();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function updateProgress(percent) {
            document.getElementById('progress-bar-fill').style.width = percent + '%';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
        function showUploadProgress() {
            elements.uploadProgress.classList.add('active');
        }
        
        // –°–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
        function hideUploadProgress() {
            elements.uploadProgress.classList.remove('active');
            document.getElementById('progress-bar-fill').style.width = '0%';
        }
        
        // –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–Ω–ª–∞–π–Ω
        function mentionAll() {
            if (!APP.users) return;
            
            const onlineUsers = APP.users.filter(u => u.status === 'online');
            const mentions = onlineUsers.map(u => `@${u.username.replace('@', '')}`).join(' ');
            
            if (mentions) {
                elements.messageInput.value = mentions + ' ';
                elements.messageInput.focus();
                autoResizeTextarea();
                showCustomAlert('–í—Å–µ –æ–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–ø–æ–º—è–Ω—É—Ç—ã', 'success');
            }
        }
        
        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
        function jumpToUnread() {
            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–≤–µ—Ä—Ö
            elements.messagesContainer.scrollTop = 0;
            showCustomAlert('–ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—á–∞–ª—É —á–∞—Ç–∞', 'info');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
        function createInvite() {
            const code = 'BOTFS23-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            
            const newInvite = {
                code: code,
                uses: 0,
                maxUses: 25,
                created: new Date().toLocaleDateString('ru-RU'),
                creator: APP.userData?.first_name || '–ê–¥–º–∏–Ω'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫
            const invitesList = document.getElementById('invites-list');
            if (invitesList.querySelector('.empty-chat')) {
                invitesList.innerHTML = '';
            }
            
            const inviteElement = document.createElement('div');
            inviteElement.className = 'invite-item';
            inviteElement.innerHTML = `
                <div>
                    <div class="invite-code">${newInvite.code}</div>
                    <div class="invite-stats">
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${newInvite.uses}/${newInvite.maxUses} | –°–æ–∑–¥–∞–Ω–æ: ${newInvite.created}
                    </div>
                </div>
                <button class="btn-copy-invite" onclick="copyInviteCode('${newInvite.code}')">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            `;
            
            invitesList.prepend(inviteElement);
            showCustomAlert('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!', 'success');
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
        function copyInviteCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showCustomAlert('–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                showCustomAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥', 'error');
            });
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞
        function clearChatHistory() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                elements.messagesContainer.innerHTML = `
                    <div class="empty-chat">
                        <i class="fas fa-comments"></i>
                        <p>–ß–∞—Ç –ø—É—Å—Ç</p>
                        <small>–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –±—ã–ª–∞ –æ—á–∏—â–µ–Ω–∞</small>
                    </div>
                `;
                showCustomAlert('–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞', 'success');
                updateStats();
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportChatData() {
            showCustomAlert('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
        function createBackup() {
            showCustomAlert('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞', 'success');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserRole(userId, newRole) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            showCustomAlert(`–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞: ${getRoleText(newRole)}`, 'success');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–∞–∑–¥–µ–ª–∞
        function updateSectionPermission(sectionId, type, value) {
            showCustomAlert(`–†–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${sectionId} ‚Üí ${value}`, 'success');
        }
        
        // –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function replyToMessage(messageId) {
            const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
            if (!messageElement) return;
            
            const sender = messageElement.querySelector('.message-sender span')?.textContent || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            const text = messageElement.querySelector('.message-text')?.textContent || '';
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞
            const replyPreview = document.getElementById('reply-preview-container');
            replyPreview.style.display = 'block';
            replyPreview.innerHTML = `
                <div class="reply-preview">
                    <div class="reply-header">
                        <div class="reply-sender">–û—Ç–≤–µ—Ç ${sender}</div>
                        <button class="btn-close-reply" onclick="closeReplyPreview()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="reply-content">${text.substring(0, 100)}${text.length > 100 ? '...' : ''}</div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
            replyPreview.querySelector('.btn-close-reply').addEventListener('click', closeReplyPreview);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–≤–µ—Ç–∞
            replyPreview.dataset.replyTo = messageId;
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            elements.messageInput.focus();
            showCustomAlert('–û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'info');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞
        function closeReplyPreview() {
            const replyPreview = document.getElementById('reply-preview-container');
            replyPreview.style.display = 'none';
            delete replyPreview.dataset.replyTo;
        }
        
        // –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function forwardMessage(messageId) {
            const forwardOptions = [
                { name: '–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç', icon: 'fas fa-comments' },
                { name: '–ù–æ–≤–æ—Å—Ç–∏', icon: 'fas fa-newspaper' },
                { name: '–û–±—ä—è–≤–ª–µ–Ω–∏—è', icon: 'fas fa-bullhorn' },
                { name: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', icon: 'fas fa-star' },
                { name: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ', icon: 'fas fa-bookmark' }
            ];
            
            const optionsContainer = document.getElementById('forward-options');
            optionsContainer.innerHTML = forwardOptions.map(option => `
                <div class="forward-option" onclick="completeForward('${messageId}', '${option.name}')">
                    <i class="${option.icon}"></i>
                    <span>${option.name}</span>
                </div>
            `).join('');
            
            elements.forwardPopup.style.display = 'flex';
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—ã–ª–∫–∏
        function completeForward(messageId, destination) {
            closeForwardPopup();
            showCustomAlert(`–°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–æ –≤: ${destination}`, 'success');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏
        function closeForwardPopup() {
            elements.forwardPopup.style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessageMenu(messageId) {
            APP.activeMessageMenu = messageId;
            
            const button = event.target.closest('.btn-more');
            const rect = button.getBoundingClientRect();
            
            elements.messageContextMenu.style.left = (rect.left - 180) + 'px';
            elements.messageContextMenu.style.top = (rect.top + 30) + 'px';
            elements.messageContextMenu.style.display = 'block';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function handleContextMenuAction(action) {
            const messageId = APP.activeMessageMenu;
            if (!messageId) return;
            
            elements.messageContextMenu.style.display = 'none';
            
            switch(action) {
                case 'reply':
                    replyToMessage(messageId);
                    break;
                    
                case 'copy':
                    copyMessageText(messageId);
                    break;
                    
                case 'copy-link':
                    copyMessageLink(messageId);
                    break;
                    
                case 'favorite':
                    addToFavorites(messageId);
                    break;
                    
                case 'forward':
                    forwardMessage(messageId);
                    break;
                    
                case 'reaction':
                    showReactionPopup(messageId);
                    break;
                    
                case 'edit':
                    editMessage(messageId);
                    break;
                    
                case 'delete':
                    deleteMessage(messageId);
                    break;
                    
                case 'report':
                    reportMessage(messageId);
                    break;
                    
                case 'select':
                    selectMessage(messageId);
                    break;
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function copyMessageText(messageId) {
            const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
            if (!messageElement) return;
            
            const text = messageElement.querySelector('.message-text')?.textContent || '';
            navigator.clipboard.writeText(text).then(() => {
                showCustomAlert('–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                showCustomAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç', 'error');
            });
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function copyMessageLink(messageId) {
            const link = `https://t.me/botfs23/message/${messageId}`;
            navigator.clipboard.writeText(link).then(() => {
                showCustomAlert('–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            }).catch(err => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                showCustomAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'error');
            });
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        function addToFavorites(messageId) {
            showCustomAlert('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ', 'success');
        }
        
        // –ü–æ–∫–∞–∑ –ø–æ–ø–∞–ø–∞ —Ä–µ–∞–∫—Ü–∏–π
        function showReactionPopup(messageId) {
            APP.activeMessageMenu = messageId;
            
            const button = event.target.closest('.btn-reaction');
            const rect = button.getBoundingClientRect();
            
            elements.reactionsPopup.style.left = (rect.left - 100) + 'px';
            elements.reactionsPopup.style.top = (rect.top - 60) + 'px';
            elements.reactionsPopup.style.display = 'block';
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏
        function addReaction(emoji) {
            const messageId = APP.activeMessageMenu;
            if (!messageId) return;
            
            elements.reactionsPopup.style.display = 'none';
            toggleReaction(messageId, emoji);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏
        function toggleReaction(messageId, emoji) {
            const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
            if (!messageElement) return;
            
            let reactionsContainer = messageElement.querySelector('.message-reactions');
            if (!reactionsContainer) {
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∞–∫—Ü–∏–π
                reactionsContainer = document.createElement('div');
                reactionsContainer.className = 'message-reactions';
                const messageContent = messageElement.querySelector('.message-content');
                const messageText = messageElement.querySelector('.message-text');
                messageContent.insertBefore(reactionsContainer, messageText.nextSibling);
            }
            
            // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–∫—Ü–∏—é
            const existingReaction = reactionsContainer.querySelector(`.reaction span:first-child`);
            let reactionElement;
            
            if (existingReaction && existingReaction.textContent === emoji) {
                reactionElement = existingReaction.closest('.reaction');
                const countElement = reactionElement.querySelector('.reaction-count');
                let count = parseInt(countElement.textContent) || 1;
                
                if (reactionElement.classList.contains('user-reacted')) {
                    count--;
                    if (count <= 0) {
                        reactionElement.remove();
                    } else {
                        countElement.textContent = count;
                        reactionElement.classList.remove('user-reacted');
                    }
                } else {
                    count++;
                    countElement.textContent = count;
                    reactionElement.classList.add('user-reacted');
                }
            } else {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ä–µ–∞–∫—Ü–∏—é
                reactionElement = document.createElement('div');
                reactionElement.className = 'reaction user-reacted';
                reactionElement.innerHTML = `
                    <span>${emoji}</span>
                    <span class="reaction-count">1</span>
                `;
                reactionElement.onclick = () => toggleReaction(messageId, emoji);
                reactionsContainer.appendChild(reactionElement);
            }
            
            showCustomAlert(`–†–µ–∞–∫—Ü–∏—è ${emoji} –¥–æ–±–∞–≤–ª–µ–Ω–∞`, 'success');
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function editMessage(messageId) {
            showCustomAlert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function deleteMessage(messageId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?')) {
                const messageElement = document.querySelector(`.message[data-id="${messageId}"]`);
                if (messageElement) {
                    messageElement.remove();
                    showCustomAlert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
                }
            }
        }
        
        // –ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function reportMessage(messageId) {
            showCustomAlert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º', 'success');
        }
        
        // –í—ã–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è
        function selectMessage(messageId) {
            showCustomAlert('–†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –°–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –ø–æ–ø–∞–ø–æ–≤
        function hideAllPopups() {
            elements.attachMenu.classList.remove('active');
            elements.emojiPicker.classList.remove('active');
            elements.messageContextMenu.style.display = 'none';
            elements.forwardPopup.style.display = 'none';
            elements.reactionsPopup.style.display = 'none';
            elements.filePreview.classList.remove('active');
            hideUploadProgress();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
        function toggleTheme() {
            APP.settings.darkTheme = elements.darkThemeToggle.checked;
            
            if (APP.settings.darkTheme) {
                document.body.classList.add('dark-theme');
                elements.themeIcon.className = 'fas fa-sun';
            } else {
                document.body.classList.remove('dark-theme');
                elements.themeIcon.className = 'fas fa-moon';
            }
            
            saveSettings();
            applySettings();
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
        function changeFontSize() {
            APP.settings.fontSize = elements.fontSizeSelect.value;
            saveSettings();
            applySettings();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª–∞
        function toggleAutoScroll() {
            APP.settings.autoScroll = elements.autoScrollToggle.checked;
            saveSettings();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function toggleSound() {
            APP.settings.soundEnabled = elements.soundToggle.checked;
            saveSettings();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–±—Ä–∞—Ü–∏–∏
        function toggleVibration() {
            APP.settings.vibrationEnabled = elements.vibrationToggle.checked;
            saveSettings();
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
        function togglePreview() {
            APP.settings.previewEnabled = elements.previewToggle.checked;
            saveSettings();
        }
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function playMessageSound() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–æ –±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
            console.log('–ó–≤—É–∫ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const messageCount = document.querySelectorAll('.message:not(.system)').length;
            const userCount = APP.users ? APP.users.length : 1;
            const onlineCount = APP.users ? APP.users.filter(u => u.status === 'online').length : 1;
            
            document.getElementById('stats-messages').textContent = messageCount;
            document.getElementById('stats-users').textContent = userCount;
            document.getElementById('stats-sections').textContent = 4;
            document.getElementById('stats-online').textContent = onlineCount;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –≤ header
            document.getElementById('online-count').textContent = onlineCount;
            document.getElementById('sidebar-online-count').textContent = onlineCount;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileInfo() {
            if (!APP.userData) return;
            
            const messageCount = document.querySelectorAll('.message.outgoing:not(.system)').length;
            
            document.getElementById('profile-messages').textContent = messageCount;
            document.getElementById('profile-joined').textContent = new Date().toLocaleDateString('ru-RU');
            document.getElementById('profile-status').textContent = '–æ–Ω–ª–∞–π–Ω';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ–Ω–ª–∞–π–Ω
        function updateOnlineCount() {
            if (!APP.users) return;
            
            const onlineCount = APP.users.filter(u => u.status === 'online').length;
            document.getElementById('online-count').textContent = onlineCount;
            document.getElementById('sidebar-online-count').textContent = onlineCount;
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        function editProfile() {
            showCustomAlert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
        function changePassword() {
            showCustomAlert('–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                localStorage.clear();
                showCustomAlert('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }
        
        // –ü–æ–∫–∞–∑ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showCustomAlert(message, type = 'info') {
            const alert = document.getElementById('custom-alert');
            if (!alert) return;
            
            alert.textContent = message;
            alert.className = 'custom-alert';
            
            // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            switch(type) {
                case 'success':
                    alert.style.background = 'var(--tg-green)';
                    break;
                case 'error':
                    alert.style.background = 'var(--tg-red)';
                    break;
                case 'warning':
                    alert.style.background = 'var(--tg-orange)';
                    break;
                default:
                    alert.style.background = 'var(--tg-primary)';
            }
            
            alert.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function hideImage(img) {
            img.style.display = 'none';
            const icon = document.getElementById('user-avatar-icon');
            if (icon) icon.style.display = 'block';
        }
        
        function hideProfileImage(img) {
            img.style.display = 'none';
            const icon = document.getElementById('profile-avatar-icon');
            if (icon) icon.style.display = 'block';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        function handleError(error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
            showCustomAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏', 'error');
        }
        
        function handleUnhandledRejection(event) {
            console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ:', event.reason);
            showCustomAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'error');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            setTimeout(() => {
                initApp();
                
                // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
                setTimeout(() => {
                    elements.loadingScreen.classList.add('hidden');
                    elements.telegramApp.style.display = 'flex';
                }, 500);
            }, 1000);
        });
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è HTML –∞—Ç—Ä–∏–±—É—Ç–æ–≤ onclick
        window.initApp = initApp;
        window.sendMessage = sendMessage;
        window.toggleSidebar = toggleSidebar;
        window.switchView = switchView;
        window.switchSection = switchSection;
        window.toggleAttachMenu = toggleAttachMenu;
        window.attachFile = attachFile;
        window.toggleEmojiPicker = toggleEmojiPicker;
        window.showEmojiCategory = showEmojiCategory;
        window.searchUsers = searchUsers;
        window.clearUserSearch = () => {
            elements.usersSearchInput.value = '';
            searchUsers('');
        };
        window.updateSectionPermission = updateSectionPermission;
        window.createInvite = createInvite;
        window.clearChatHistory = clearChatHistory;
        window.exportChatData = exportChatData;
        window.createBackup = createBackup;
        window.jumpToUnread = jumpToUnread;
        window.mentionAll = mentionAll;
        window.showReactionPopup = showReactionPopup;
        window.addReaction = addReaction;
        window.toggleReaction = toggleReaction;
        window.replyToMessage = replyToMessage;
        window.forwardMessage = forwardMessage;
        window.showMessageMenu = showMessageMenu;
        window.closeForwardPopup = closeForwardPopup;
        window.sendFile = sendFile;
        window.cancelFile = cancelFile;
        window.toggleTheme = toggleTheme;
        window.changeFontSize = changeFontSize;
        window.editProfile = editProfile;
        window.changePassword = changePassword;
        window.logout = logout;
        window.copyInviteCode = copyInviteCode;
        window.updateUserRole = updateUserRole;
    </script>
</body>
</html>
