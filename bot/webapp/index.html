<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botfs23 - Telegram Chat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="telegram-app">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="btn-menu" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="chat-info">
                    <div class="chat-title">Botfs23</div>
                    <div class="chat-status">–æ–Ω–ª–∞–π–Ω: <span id="online-count">2</span></div>
                </div>
            </div>
            <div class="header-right">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä—ã–∂–∫–∞ –∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º -->
                <button class="btn-jump" id="btn-jump" onclick="jumpToUnread()">
                    <i class="fas fa-arrow-down"></i>
                    <span class="unread-badge" id="unread-badge">0</span>
                </button>
                <!-- –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
                <button class="btn-admin" id="btn-admin" onclick="showAdminPanel()">
                    <i class="fas fa-user-shield"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar" id="user-avatar">
                        <img id="user-avatar-img" src="" alt="" onerror="hideImage(this)">
                        <i class="fas fa-user" id="user-avatar-icon"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                        <div class="user-role" id="user-role">—É—á–∞—Å—Ç–Ω–∏–∫</div>
                    </div>
                </div>
                <button class="btn-close-sidebar" onclick="toggleSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
            <div class="sections-list">
                <div class="section-item active" onclick="switchSection('main')">
                    <i class="fas fa-comments"></i>
                    <span class="section-name">–û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç</span>
                    <span class="section-unread" id="main-unread">0</span>
                </div>
                <div class="section-item" onclick="switchSection('news')">
                    <i class="fas fa-newspaper"></i>
                    <span class="section-name">–ù–æ–≤–æ—Å—Ç–∏</span>
                    <span class="section-unread" id="news-unread">0</span>
                </div>
                <div class="section-item" onclick="switchSection('rules')">
                    <i class="fas fa-book"></i>
                    <span class="section-name">–ü—Ä–∞–≤–∏–ª–∞</span>
                    <span class="section-locked"><i class="fas fa-lock"></i></span>
                </div>
                <div class="section-item" onclick="switchSection('announcements')">
                    <i class="fas fa-bullhorn"></i>
                    <span class="section-name">–û–±—ä—è–≤–ª–µ–Ω–∏—è</span>
                    <span class="section-unread" id="announcements-unread">0</span>
                </div>
            </div>
            
            <!-- –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div class="sidebar-menu">
                <div class="menu-item active" onclick="showChat()">
                    <i class="fas fa-comments"></i>
                    <span>–ß–∞—Ç</span>
                    <span class="menu-badge" id="chat-badge">0</span>
                </div>
                <div class="menu-item" onclick="showUsersList()">
                    <i class="fas fa-users"></i>
                    <span>–£—á–∞—Å—Ç–Ω–∏–∫–∏</span>
                    <span class="menu-badge" id="users-badge">0</span>
                </div>
                <div class="menu-item" onclick="showAdminPanel()" id="admin-menu-item">
                    <i class="fas fa-user-shield"></i>
                    <span>–ê–¥–º–∏–Ω–∫–∞</span>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="online-users">
                    <i class="fas fa-circle online-dot"></i>
                    <span id="sidebar-online-count">2</span> –æ–Ω–ª–∞–π–Ω
                </div>
                <div class="app-version">v2.0</div>
            </div>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ -->
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ -->
        <div class="chat-container active" id="chat-view">
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="messages-container" id="messages-container">
                <!-- –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="message system" data-message-id="1">
                    <div class="message-content">
                        <div class="message-system">
                            <i class="fas fa-info-circle"></i>
                            <div class="message-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç! –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ.</div>
                            <div class="message-time">13:47</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ä–µ–∞–∫—Ü–∏—è–º–∏ -->
                <div class="message incoming" data-message-id="2">
                    <div class="message-avatar" style="background-color: #4caf50;">–ü</div>
                    <div class="message-content">
                        <div class="message-header">
                            <div class="message-sender">
                                –ü–µ—Ç—Ä
                                <span class="message-sender-role admin">–∞–¥–º–∏–Ω</span>
                            </div>
                            <div class="message-time">13:48</div>
                        </div>
                        <div class="message-text">–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —á–∞—Ç.</div>
                        
                        <!-- –†–µ–∞–∫—Ü–∏–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º -->
                        <div class="message-reactions">
                            <div class="reaction">
                                üëç <span class="reaction-count">3</span>
                            </div>
                            <div class="reaction">
                                ‚ù§Ô∏è <span class="reaction-count">2</span>
                            </div>
                        </div>
                        
                        <!-- –í—Ä–µ–º—è –∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—á—Ç–µ–Ω–∏—è -->
                        <div class="message-status">
                            <i class="fas fa-check-double"></i>
                            <div class="message-time">13:48</div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é -->
                    <button class="btn-message-menu" onclick="showMessageMenu(this, 2)">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
                
                <!-- –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≥–æ–ª–æ—Å–æ–≤—ã–º -->
                <div class="message outgoing" data-message-id="3">
                    <div class="message-content">
                        <div class="message-text">–í–æ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</div>
                        
                        <!-- –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                        <div class="message-voice">
                            <button class="voice-play-btn" onclick="toggleVoicePlayback(this)">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="voice-waveform"></div>
                            <div class="voice-duration">0:15</div>
                        </div>
                        
                        <!-- –†–µ–∞–∫—Ü–∏–∏ -->
                        <div class="message-reactions">
                            <div class="reaction user-reacted">
                                ‚ù§Ô∏è <span class="reaction-count">1</span>
                            </div>
                        </div>
                        
                        <div class="message-status">
                            <i class="fas fa-check-double"></i>
                            <div class="message-time">13:55</div>
                        </div>
                    </div>
                    
                    <button class="btn-message-menu" onclick="showMessageMenu(this, 3)">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
            
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
            <div class="message-input-area">
                <button class="btn-attach" onclick="toggleAttachMenu()">
                    <i class="fas fa-paperclip"></i>
                </button>
                
                <div class="attach-menu" id="attach-menu">
                    <div class="attach-item" onclick="attachFile('photo')">
                        <i class="fas fa-image"></i>
                        <span>–§–æ—Ç–æ</span>
                    </div>
                    <div class="attach-item" onclick="attachFile('voice')">
                        <i class="fas fa-microphone"></i>
                        <span>–ì–æ–ª–æ—Å–æ–≤–æ–µ</span>
                    </div>
                    <div class="attach-item" onclick="attachFile('document')">
                        <i class="fas fa-file"></i>
                        <span>–î–æ–∫—É–º–µ–Ω—Ç</span>
                    </div>
                </div>
                
                <div class="input-wrapper">
                    <input type="text" 
                           id="message-input" 
                           placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                           onkeypress="handleKeyPress(event)">
                    <div class="input-actions">
                        <button class="btn-emoji" onclick="toggleEmojiPicker()">
                            <i class="far fa-smile"></i>
                        </button>
                    </div>
                </div>
                
                <button class="btn-send" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <!-- –≠–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä -->
            <div class="emoji-picker" id="emoji-picker">
                <div class="emoji-categories">
                    <button class="emoji-category active" onclick="showEmojiCategory('smileys')">üòÄ</button>
                    <button class="emoji-category" onclick="showEmojiCategory('people')">üëã</button>
                    <button class="emoji-category" onclick="showEmojiCategory('symbols')">‚ù§Ô∏è</button>
                </div>
                <div class="emoji-grid" id="emoji-grid"></div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏—è (–∫–∞–∫ –≤ Telegram) -->
        <div class="message-context-menu" id="message-context-menu">
            <div class="context-menu-item" onclick="replyToMessage()">
                <i class="fas fa-reply"></i>
                <span>–û—Ç–≤–µ—Ç–∏—Ç—å</span>
            </div>
            <div class="context-menu-item" onclick="copyMessageLink()">
                <i class="fas fa-link"></i>
                <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</span>
            </div>
            <div class="context-menu-item" onclick="addToFavorites()">
                <i class="fas fa-star"></i>
                <span>–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </div>
            <div class="context-menu-item" onclick="forwardMessage()">
                <i class="fas fa-share"></i>
                <span>–ü–µ—Ä–µ—Å–ª–∞—Ç—å</span>
            </div>
            <div class="context-menu-item" onclick="addReactionMenu()">
                <i class="far fa-smile"></i>
                <span>–†–µ–∞–∫—Ü–∏—è</span>
            </div>
            <div class="context-menu-divider"></div>
            <div class="context-menu-item" onclick="deleteMessage()">
                <i class="fas fa-trash"></i>
                <span>–£–¥–∞–ª–∏—Ç—å</span>
            </div>
            <div class="context-menu-item" onclick="reportMessage()">
                <i class="fas fa-flag"></i>
                <span>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</span>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div class="admin-container" id="admin-view">
            <div class="admin-header">
                <h2><i class="fas fa-user-shield"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
            </div>
            
            <div class="admin-sections">
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                <div class="admin-section">
                    <h3><i class="fas fa-users-cog"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>
                    <div class="admin-users-list" id="admin-users-list">
                        <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
                        <div class="admin-user-item">
                            <div class="admin-user-info">
                                <div class="admin-user-avatar" style="background-color: #4caf50;">–ü</div>
                                <div>
                                    <div class="admin-user-name">–ü–µ—Ç—Ä <span class="user-role-badge admin">–∞–¥–º–∏–Ω</span></div>
                                    <div class="admin-user-id">ID: 123456</div>
                                </div>
                            </div>
                            <div class="admin-user-actions">
                                <button class="btn-admin-action" onclick="changeUserRole(123456, 'user')">
                                    <i class="fas fa-user"></i> –°–Ω—è—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
                <div class="admin-section">
                    <h3><i class="fas fa-folder"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞–º–∏</h3>
                    <div class="sections-admin-list">
                        <div class="section-permissions">
                            <div class="permission-item">
                                <span>–ü—Ä–∞–≤–∏–ª–∞:</span>
                                <select class="permission-select" onchange="updateSectionPermission('rules', 'write', this.value)">
                                    <option value="admins">–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã</option>
                                    <option value="all">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–µ–∞–∫—Ü–∏–∏ –ø–æ–ø–∞–ø -->
    <div class="reactions-popup" id="reactions-popup">
        <div class="reactions-options">
            <button class="reaction-option" onclick="addReaction('üëç')">üëç</button>
            <button class="reaction-option" onclick="addReaction('‚ù§Ô∏è')">‚ù§Ô∏è</button>
            <button class="reaction-option" onclick="addReaction('üòÇ')">üòÇ</button>
            <button class="reaction-option" onclick="addReaction('üòÆ')">üòÆ</button>
            <button class="reaction-option" onclick="addReaction('üò¢')">üò¢</button>
            <button class="reaction-option" onclick="addReaction('üéâ')">üéâ</button>
        </div>
    </div>

    <script>
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function hideImage(img) {
            img.style.display = 'none';
            document.getElementById('user-avatar-icon').style.display = 'block';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ç–æ –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                const user = tg.initDataUnsafe?.user;
                
                if (user && user.photo_url) {
                    const img = document.getElementById('user-avatar-img');
                    img.src = user.photo_url;
                    img.style.display = 'block';
                    document.getElementById('user-avatar-icon').style.display = 'none';
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            document.getElementById('admin-menu-item').style.display = 'none';
            document.getElementById('btn-admin').style.display = 'none';
        });
    </script>
    
    <script src="script.js"></script>
</body>
</html>
